{% load static %}
{% load dict_filters %}
<div id="{{ widget.attrs.id }}_container" class="json-widget weekday-prices-widget">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
        {% for day_key, day_label in widget.weekdays %}
        <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                <i class="fas fa-calendar-day mr-2 text-vb-primary"></i>
                {{ day_label }}
            </label>
            <input type="number" 
                   step="0.01" 
                   min="0"
                   name="{{ widget.name }}_{{ day_key }}"
                   value="{% if widget.prices|get_item:day_key %}{{ widget.prices|get_item:day_key }}{% endif %}" 
                   class="weekday-price form-control" 
                   placeholder="Fiyat girin">
        </div>
        {% endfor %}
    </div>
    <input type="hidden" id="{{ widget.attrs.id }}_json" name="{{ widget.name }}" value="{{ widget.value|default:'{}' }}">
</div>

<script>
(function() {
    const container = document.getElementById('{{ widget.attrs.id }}_container');
    if (!container) return;
    
    const hiddenInput = document.getElementById('{{ widget.attrs.id }}_json');
    if (!hiddenInput) return;
    
    const priceInputs = container.querySelectorAll('.weekday-price');
    if (!priceInputs || priceInputs.length === 0) return;
    
    function updateHiddenInput() {
        if (!hiddenInput) return;
        
        const prices = {};
        priceInputs.forEach(input => {
            if (!input) return;
            
            const dayKey = input.name.replace('{{ widget.name }}_', '');
            const value = input.value.trim();
            if (value) {
                try {
                    const priceValue = parseFloat(value);
                    if (!isNaN(priceValue)) {
                        prices[dayKey] = priceValue;
                    }
                } catch {
                    // Hata durumunda atla
                }
            }
        });
        hiddenInput.value = JSON.stringify(prices);
    }
    
    priceInputs.forEach(input => {
        if (input) {
            input.addEventListener('input', updateHiddenInput);
            input.addEventListener('blur', updateHiddenInput);
        }
    });
    
    // İlk yüklemede güncelle
    updateHiddenInput();
})();
</script>

