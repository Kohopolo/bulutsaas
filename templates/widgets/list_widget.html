{% load static %}
<div id="{{ widget.attrs.id }}_container" class="json-widget list-widget">
    <div class="items-container space-y-2">
        {% for item in widget.items %}
        <div class="item-item flex items-center gap-3">
            <div class="flex-1">
                <input type="text" 
                       value="{{ item }}" 
                       class="list-item form-control" 
                       placeholder="{{ widget.item_label }}">
            </div>
            <div>
                <button type="button" class="remove-item-btn text-red-600 hover:text-red-700 p-2" title="Sil">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        {% empty %}
        <div class="item-item flex items-center gap-3" style="display: none;">
            <div class="flex-1">
                <input type="text" 
                       class="list-item form-control" 
                       placeholder="{{ widget.item_label }}">
            </div>
            <div>
                <button type="button" class="remove-item-btn text-red-600 hover:text-red-700 p-2" title="Sil">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    <button type="button" class="add-item-btn mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
        <i class="fas fa-plus mr-2"></i>
        Yeni {{ widget.item_label }} Ekle
    </button>
    <input type="hidden" id="{{ widget.attrs.id }}_json" name="{{ widget.name }}" value="{{ widget.value|default:'[]' }}">
</div>

<script>
(function() {
    const container = document.getElementById('{{ widget.attrs.id }}_container');
    if (!container) return;
    
    const hiddenInput = document.getElementById('{{ widget.attrs.id }}_json');
    const itemsContainer = container.querySelector('.items-container');
    const addBtn = container.querySelector('.add-item-btn');
    
    function updateHiddenInput() {
        if (!hiddenInput || !itemsContainer) return;
        
        const items = [];
        itemsContainer.querySelectorAll('.item-item:not([style*="display: none"])').forEach(item => {
            const input = item.querySelector('.list-item');
            if (input) {
                const value = input.value.trim();
                if (value) {
                    items.push(value);
                }
            }
        });
        hiddenInput.value = JSON.stringify(items);
    }
    
    function addItem(value = '') {
        if (!itemsContainer) return;
        
        const template = itemsContainer.querySelector('.item-item[style*="display: none"]') || 
                        itemsContainer.querySelector('.item-item');
        if (!template) return;
        
        const newItem = template.cloneNode(true);
        newItem.style.display = 'flex';
        const input = newItem.querySelector('.list-item');
        if (input) input.value = value;
        itemsContainer.appendChild(newItem);
        
        const removeBtn = newItem.querySelector('.remove-item-btn');
        if (removeBtn) {
            removeBtn.addEventListener('click', function() {
                newItem.remove();
                updateHiddenInput();
            });
        }
        
        const listInput = newItem.querySelector('.list-item');
        if (listInput) {
            listInput.addEventListener('input', updateHiddenInput);
        }
        
        updateHiddenInput();
    }
    
    if (addBtn) {
        addBtn.addEventListener('click', function() {
            addItem();
        });
    }
    
    // Mevcut item'ler için event listener'lar
    if (itemsContainer) {
        itemsContainer.querySelectorAll('.item-item').forEach(item => {
            if (item.style.display !== 'none') {
                const removeBtn = item.querySelector('.remove-item-btn');
                if (removeBtn) {
                    removeBtn.addEventListener('click', function() {
                        item.remove();
                        updateHiddenInput();
                    });
                }
                
                const listInput = item.querySelector('.list-item');
                if (listInput) {
                    listInput.addEventListener('input', updateHiddenInput);
                }
            }
        });
    }
    
    // İlk yüklemede güncelle
    if (hiddenInput) {
        updateHiddenInput();
    }
})();
</script>

