{% extends 'vb_theme/layouts/base.html' %}
{% load static %}

{% block title %}Rezervasyon Listesi{% endblock %}
{% block page_title %}Rezervasyon Listesi{% endblock %}
{% block page_description %}Tüm rezervasyonları görüntüle ve yönet{% endblock %}

{% block toolbar_left %}
<button class="vb-button vb-button-primary" data-action="new">
    <i class="fas fa-plus"></i> Yeni Rezervasyon
</button>
<button class="vb-button vb-button-success" data-action="checkin">
    <i class="fas fa-sign-in-alt"></i> Check-in
</button>
<button class="vb-button vb-button-warning" data-action="checkout">
    <i class="fas fa-sign-out-alt"></i> Check-out
</button>
<button class="vb-button vb-button-danger" data-action="cancel">
    <i class="fas fa-ban"></i> İptal Et
</button>
{% endblock %}

{% block content %}

<!-- Filters Bar -->
<div class="filters-bar">
    <div class="filter-group">
        <label>Tarih Aralığı</label>
        <input type="date" class="vb-input" name="start_date" value="{% now 'Y-m-d' %}">
    </div>
    
    <div class="filter-group">
        <label>Bitiş Tarihi</label>
        <input type="date" class="vb-input" name="end_date">
    </div>
    
    <div class="filter-group">
        <label>Durum</label>
        <select class="vb-select" name="status">
            <option value="">Tümü</option>
            <option value="pending">Beklemede</option>
            <option value="confirmed">Onaylı</option>
            <option value="checkedin">Check-in Yapıldı</option>
            <option value="checkedout">Check-out Yapıldı</option>
            <option value="cancelled">İptal</option>
        </select>
    </div>
    
    <div class="filter-group">
        <label>Oda Tipi</label>
        <select class="vb-select" name="room_type">
            <option value="">Tümü</option>
            <option value="std">STD - Standart</option>
            <option value="dlx">DLX - Deluxe</option>
            <option value="suite">SUITE - Suit</option>
            <option value="family">FAMILY - Aile</option>
        </select>
    </div>
    
    <div class="filter-group">
        <label>Misafir Adı</label>
        <input type="text" class="vb-input" name="guest_name" placeholder="Ara...">
    </div>
    
    <div class="filter-group">
        <label>Rezervasyon No</label>
        <input type="text" class="vb-input" name="reservation_code" placeholder="ETSR...">
    </div>
    
    <div class="filter-group" style="align-self: flex-end;">
        <button class="vb-button vb-button-primary" data-action="apply-filters">
            <i class="fas fa-search"></i> Ara
        </button>
    </div>
    
    <div class="filter-group" style="align-self: flex-end;">
        <button class="vb-button" data-action="clear-filters">
            <i class="fas fa-times"></i> Temizle
        </button>
    </div>
</div>

<!-- Rezervasyon DataGrid -->
<div class="vb-datagrid">
    <div class="vb-datagrid-container">
        <table id="rezervasyon-grid">
            <thead>
                <tr>
                    <th style="width: 40px;">
                        <input type="checkbox" id="select-all">
                    </th>
                    <th data-sortable="true" style="width: 120px;">Rez. No</th>
                    <th data-sortable="true">Oda No</th>
                    <th data-sortable="true">Oda Tipi</th>
                    <th data-sortable="true">Misafir Adı</th>
                    <th data-sortable="true" style="width: 120px;">Giriş Tarihi</th>
                    <th data-sortable="true" style="width: 120px;">Çıkış Tarihi</th>
                    <th data-sortable="true">Kişi</th>
                    <th data-sortable="true">Tutar</th>
                    <th data-sortable="true">Durum</th>
                    <th data-sortable="true">Kanal</th>
                    <th style="width: 140px; text-align: right;">İşlemler</th>
                </tr>
            </thead>
            <tbody>
                {% if reservations %}
                    {% for rez in reservations %}
                    <tr data-id="{{ rez.id }}" 
                        {% if rez.is_today_checkin %}class="highlight-warning"{% endif %}
                        {% if rez.is_today_checkout %}class="highlight-danger"{% endif %}>
                        <td>
                            <input type="checkbox" class="row-checkbox" value="{{ rez.id }}">
                        </td>
                        <td><strong>{{ rez.code }}</strong></td>
                        <td><strong>{{ rez.room_number }}</strong></td>
                        <td>{{ rez.room_type }}</td>
                        <td>
                            <div>{{ rez.guest_name }}</div>
                            {% if rez.guest_phone %}
                            <small style="color: #6c757d;">{{ rez.guest_phone }}</small>
                            {% endif %}
                        </td>
                        <td>{{ rez.check_in|date:"d.m.Y H:i" }}</td>
                        <td>{{ rez.check_out|date:"d.m.Y H:i" }}</td>
                        <td>{{ rez.adults }}+{{ rez.children }}</td>
                        <td><strong>₺{{ rez.total_amount }}</strong></td>
                        <td>
                            {% if rez.status == 'confirmed' %}
                            <span style="display: inline-block; padding: 4px 10px; background: var(--status-clean); color: white; border-radius: 12px; font-size: 11px; font-weight: 600;">
                                ONAY LI
                            </span>
                            {% elif rez.status == 'pending' %}
                            <span style="display: inline-block; padding: 4px 10px; background: var(--status-reserved); color: #333; border-radius: 12px; font-size: 11px; font-weight: 600;">
                                BEKLEMEDE
                            </span>
                            {% elif rez.status == 'checkedin' %}
                            <span style="display: inline-block; padding: 4px 10px; background: var(--status-dirty); color: white; border-radius: 12px; font-size: 11px; font-weight: 600;">
                                CHECK-IN
                            </span>
                            {% elif rez.status == 'checkedout' %}
                            <span style="display: inline-block; padding: 4px 10px; background: #6c757d; color: white; border-radius: 12px; font-size: 11px; font-weight: 600;">
                                CHECK-OUT
                            </span>
                            {% elif rez.status == 'cancelled' %}
                            <span style="display: inline-block; padding: 4px 10px; background: var(--status-occupied); color: white; border-radius: 12px; font-size: 11px; font-weight: 600;">
                                İPTAL
                            </span>
                            {% endif %}
                        </td>
                        <td>
                            <small>{{ rez.channel|default:"Direct" }}</small>
                        </td>
                        <td>
                            <div class="vb-datagrid-actions">
                                <button class="vb-button vb-button-icon vb-button-primary" 
                                        data-action="view" 
                                        data-id="{{ rez.id }}"
                                        data-tooltip="Görüntüle">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="vb-button vb-button-icon" 
                                        data-action="edit" 
                                        data-id="{{ rez.id }}"
                                        data-tooltip="Düzenle">
                                    <i class="fas fa-edit"></i>
                                </button>
                                {% if rez.status == 'confirmed' %}
                                <button class="vb-button vb-button-icon vb-button-success" 
                                        data-action="checkin" 
                                        data-id="{{ rez.id }}"
                                        data-tooltip="Check-in">
                                    <i class="fas fa-sign-in-alt"></i>
                                </button>
                                {% elif rez.status == 'checkedin' %}
                                <button class="vb-button vb-button-icon vb-button-warning" 
                                        data-action="checkout" 
                                        data-id="{{ rez.id }}"
                                        data-tooltip="Check-out">
                                    <i class="fas fa-sign-out-alt"></i>
                                </button>
                                {% endif %}
                                <button class="vb-button vb-button-icon vb-button-danger" 
                                        data-action="delete" 
                                        data-id="{{ rez.id }}"
                                        data-tooltip="Sil">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="12" style="text-align: center; padding: 60px; color: #6c757d;">
                            <i class="fas fa-calendar-alt" style="font-size: 64px; opacity: 0.2;"></i>
                            <p style="margin-top: 16px; font-size: 16px;">Rezervasyon bulunamadı</p>
                            <button class="vb-button vb-button-primary" style="margin-top: 16px;">
                                <i class="fas fa-plus"></i> İlk Rezervasyonu Oluştur
                            </button>
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Pagination -->
{% if pagination %}
<div class="vb-datagrid-pagination" style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0;">
    <div class="pagination-info">
        Toplam <strong>{{ pagination.total|default:0 }}</strong> kayıt içinden 
        <strong>{{ pagination.start|default:1 }}-{{ pagination.end|default:50 }}</strong> arası gösteriliyor
    </div>
    <div class="pagination-controls" style="display: flex; gap: 4px;">
        {% if pagination.has_previous %}
        <button class="vb-button vb-button-icon" onclick="location.href='?page=1'">
            <i class="fas fa-angle-double-left"></i>
        </button>
        <button class="vb-button vb-button-icon" onclick="location.href='?page={{ pagination.previous }}'">
            <i class="fas fa-angle-left"></i>
        </button>
        {% endif %}
        
        <span style="padding: 0 16px; line-height: 32px;">
            Sayfa <strong>{{ pagination.current|default:1 }}</strong> / <strong>{{ pagination.total_pages|default:1 }}</strong>
        </span>
        
        {% if pagination.has_next %}
        <button class="vb-button vb-button-icon" onclick="location.href='?page={{ pagination.next }}'">
            <i class="fas fa-angle-right"></i>
        </button>
        <button class="vb-button vb-button-icon" onclick="location.href='?page={{ pagination.total_pages }}'">
            <i class="fas fa-angle-double-right"></i>
        </button>
        {% endif %}
    </div>
</div>
{% endif %}

<!-- Summary Stats -->
<div class="vb-groupbox" style="margin-top: 20px;">
    <div class="vb-groupbox-title">
        <i class="fas fa-chart-bar"></i> Özet İstatistikler
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; padding: 10px 0;">
        <div style="text-align: center;">
            <div style="font-size: 28px; font-weight: 700; color: var(--button-primary);">
                {{ summary.total|default:0 }}
            </div>
            <div style="font-size: 12px; color: #6c757d; margin-top: 4px;">Toplam Rezervasyon</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 28px; font-weight: 700; color: var(--button-success);">
                {{ summary.confirmed|default:0 }}
            </div>
            <div style="font-size: 12px; color: #6c757d; margin-top: 4px;">Onaylı</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 28px; font-weight: 700; color: var(--button-warning);">
                {{ summary.pending|default:0 }}
            </div>
            <div style="font-size: 12px; color: #6c757d; margin-top: 4px;">Beklemede</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 28px; font-weight: 700; color: var(--button-danger);">
                {{ summary.cancelled|default:0 }}
            </div>
            <div style="font-size: 12px; color: #6c757d; margin-top: 4px;">İptal</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 28px; font-weight: 700; color: var(--navy-primary);">
                ₺{{ summary.total_revenue|default:"0" }}
            </div>
            <div style="font-size: 12px; color: #6c757d; margin-top: 4px;">Toplam Gelir</div>
        </div>
    </div>
</div>

{% endblock %}

{% block inline_js %}
// Rezervasyon List specific JavaScript
console.log('Rezervasyon List loaded');

// Row actions
document.querySelectorAll('[data-action]').forEach(function(button) {
    button.addEventListener('click', function(e) {
        e.stopPropagation();
        const action = this.dataset.action;
        const id = this.dataset.id;
        
        switch(action) {
            case 'view':
                console.log('View reservation:', id);
                // window.location.href = '/rezervasyon/' + id + '/';
                break;
            case 'edit':
                console.log('Edit reservation:', id);
                // window.location.href = '/rezervasyon/' + id + '/edit/';
                break;
            case 'checkin':
                VBComponents.confirm('Check-in yapmak istediğinizden emin misiniz?', function() {
                    console.log('Check-in:', id);
                    VBComponents.notify('Check-in işlemi başarılı', 'success');
                });
                break;
            case 'checkout':
                VBComponents.confirm('Check-out yapmak istediğinizden emin misiniz?', function() {
                    console.log('Check-out:', id);
                    VBComponents.notify('Check-out işlemi başarılı', 'success');
                });
                break;
            case 'delete':
                VBComponents.confirm('Rezervasyonu silmek istediğinizden emin misiniz?', function() {
                    console.log('Delete:', id);
                    VBComponents.notify('Rezervasyon silindi', 'error');
                });
                break;
        }
    });
});
{% endblock %}


