{% extends "tenant/base.html" %}
{% load static %}

{% block title %}Paket Yenileme - Kiracı Üye Paneli{% endblock %}
{% block page_title %}Paket Yenileme{% endblock %}

{% block content %}
<div class="content-body">
    <!-- Mevcut Abonelik Bilgileri -->
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-sync-alt"></i> Aboneliği Yenile
        </div>
        <div class="groupbox-body">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h3 style="font-size: 13px; font-weight: bold; color: #2C5F8D; margin-bottom: 10px;">Mevcut Abonelik</h3>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="font-size: 12px; color: #666;">Paket:</span>
                            <span style="font-weight: 600; font-size: 12px;">{{ package.name }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="font-size: 12px; color: #666;">Durum:</span>
                            <span style="padding: 2px 8px; border-radius: 3px; font-size: 11px; font-weight: 600; {% if subscription.status == 'active' %}background-color: #d4edda; color: #155724;{% else %}background-color: #fff3cd; color: #856404;{% endif %}">
                                {{ subscription.get_status_display }}
                            </span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="font-size: 12px; color: #666;">Bitiş Tarihi:</span>
                            <span style="font-weight: 600; font-size: 12px; {% if subscription.days_remaining <= 7 %}color: #dc3545;{% elif subscription.days_remaining <= 30 %}color: #ffc107;{% else %}color: #28a745;{% endif %}">
                                {{ subscription.end_date|date:"d.m.Y" }}
                            </span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="font-size: 12px; color: #666;">Kalan Gün:</span>
                            <span style="font-weight: bold; font-size: 13pt; {% if subscription.days_remaining <= 7 %}color: #dc3545;{% elif subscription.days_remaining <= 30 %}color: #ffc107;{% else %}color: #0078D4;{% endif %}">
                                {{ subscription.days_remaining }} gün
                            </span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 style="font-size: 13px; font-weight: bold; color: #2C5F8D; margin-bottom: 10px;">Yenileme Seçenekleri</h3>
                    <form method="post" style="display: flex; flex-direction: column; gap: 12px;">
                        {% csrf_token %}
                        
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; padding: 10px; background-color: #F8F9FA; border: 1px solid #D4D4D4; border-radius: 3px; cursor: pointer;">
                                <input type="radio" name="period" value="monthly" checked style="margin-right: 10px;">
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; font-size: 12px; color: #333; margin-bottom: 2px;">Aylık Yenileme</div>
                                    <div style="font-size: 11px; color: #666;">
                                        {{ package.price_monthly }} {{ package.currency }} / ay
                                    </div>
                                </div>
                            </label>
                            
                            {% if package.price_yearly %}
                            <label style="display: flex; align-items: center; padding: 10px; background-color: #F8F9FA; border: 1px solid #D4D4D4; border-radius: 3px; cursor: pointer;">
                                <input type="radio" name="period" value="yearly" style="margin-right: 10px;">
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; font-size: 12px; color: #333; margin-bottom: 2px;">Yıllık Yenileme</div>
                                    <div style="font-size: 11px; color: #666;">
                                        {{ package.price_yearly }} {{ package.currency }} / yıl
                                        {% if package.get_yearly_discount_percentage %}
                                        <span style="color: #28a745; font-weight: 600; margin-left: 5px;">
                                            (%{{ package.get_yearly_discount_percentage }} indirim)
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                            </label>
                            {% endif %}
                        </div>
                        
                        {% if superadmin_gateway %}
                        <div style="background-color: #cfe2ff; border: 1px solid #084298; border-radius: 3px; padding: 10px;">
                            <p style="font-size: 11px; color: #084298;">
                                <i class="fas fa-info-circle"></i> Ödeme işlemi için sistem ödeme yöntemi kullanılacaktır: <strong>{{ superadmin_gateway.gateway.name }}</strong>
                            </p>
                        </div>
                        {% else %}
                        <div style="background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 3px; padding: 10px;">
                            <p style="font-size: 11px; color: #856404;">
                                <i class="fas fa-exclamation-triangle"></i> <strong>Uyarı:</strong> Ödeme gateway ayarları bulunamadı. Lütfen sistem yöneticisine başvurun.
                            </p>
                        </div>
                        {% endif %}
                        
                        <div style="background-color: #d4edda; border: 1px solid #28a745; border-radius: 3px; padding: 10px;">
                            <p style="font-size: 11px; color: #155724;">
                                <i class="fas fa-info-circle"></i> Aboneliğiniz mevcut bitiş tarihinden sonra seçtiğiniz dönem kadar uzatılacaktır.
                            </p>
                        </div>
                        
                        <div style="display: flex; gap: 8px; margin-top: 10px;">
                            {% if superadmin_gateway %}
                            <button type="submit" class="vb-button success" style="flex: 1; padding: 8px 16px; font-size: 12px;">
                                <i class="fas fa-credit-card"></i> Ödemeye Geç
                            </button>
                            {% else %}
                            <button type="submit" class="vb-button" style="flex: 1; padding: 8px 16px; font-size: 12px; background-color: #6c757d; color: white; cursor: not-allowed;" disabled>
                                <i class="fas fa-ban"></i> Ödeme Gateway Bulunamadı
                            </button>
                            {% endif %}
                            <button type="button" onclick="closeModal()" class="vb-button" style="padding: 8px 16px; font-size: 12px;">
                                İptal
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
