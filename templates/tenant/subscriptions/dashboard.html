{% extends "tenant/base.html" %}
{% load static %}

{% block title %}Paket Yönetimi - Kiracı Üye Paneli{% endblock %}
{% block page_title %}Paket Yönetimi{% endblock %}

{% block content %}
<div class="p-6">
    <!-- Paket Bilgileri Card -->
    <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm mb-6">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold text-vb-navy">
                <i class="fas fa-box mr-2 text-vb-primary"></i>
                Mevcut Paket
            </h2>
            {% if subscription %}
            <span class="px-4 py-2 rounded-lg text-sm font-semibold {% if subscription.status == 'active' %}bg-green-100 text-green-700{% elif subscription.status == 'trial' %}bg-yellow-100 text-yellow-700{% else %}bg-red-100 text-red-700{% endif %}">
                {{ subscription.get_status_display }}
            </span>
            {% endif %}
        </div>
        
        {% if package %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">{{ package.name }}</h3>
                <p class="text-gray-600 mb-4">{{ package.description|default:"Açıklama yok" }}</p>
                
                <div class="space-y-2">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">Aylık Fiyat:</span>
                        <span class="font-bold text-vb-primary text-lg">{{ package.price_monthly }} {{ package.currency }}</span>
                    </div>
                    {% if package.price_yearly %}
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">Yıllık Fiyat:</span>
                        <span class="font-bold text-vb-primary text-lg">{{ package.price_yearly }} {{ package.currency }}</span>
                    </div>
                    {% if package.get_yearly_discount_percentage %}
                    <div class="text-sm text-green-600">
                        <i class="fas fa-percent mr-1"></i>
                        Yıllık abonelikte %{{ package.get_yearly_discount_percentage }} indirim
                    </div>
                    {% endif %}
                    {% endif %}
                </div>
            </div>
            
            <div>
                {% if subscription %}
                <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                    <div>
                        <p class="text-sm text-gray-600">Başlangıç Tarihi</p>
                        <p class="font-semibold">{{ subscription.start_date|date:"d.m.Y" }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Bitiş Tarihi</p>
                        <p class="font-semibold {% if subscription.days_remaining <= 7 %}text-red-600{% elif subscription.days_remaining <= 30 %}text-yellow-600{% else %}text-green-600{% endif %}">
                            {{ subscription.end_date|date:"d.m.Y" }}
                        </p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Kalan Gün</p>
                        <p class="font-semibold text-lg {% if subscription.days_remaining <= 7 %}text-red-600{% elif subscription.days_remaining <= 30 %}text-yellow-600{% else %}text-green-600{% endif %}">
                            {{ subscription.days_remaining }} gün
                        </p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Otomatik Yenileme</p>
                        <p class="font-semibold">
                            {% if subscription.auto_renew %}
                                <i class="fas fa-check-circle text-green-600"></i> Aktif
                            {% else %}
                                <i class="fas fa-times-circle text-red-600"></i> Pasif
                            {% endif %}
                        </p>
                    </div>
                </div>
                {% else %}
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <p class="text-yellow-800">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Aktif abonelik bulunamadı.
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="mt-6 flex space-x-3">
            <a href="{% url 'tenant_subscriptions:details' %}" class="px-4 py-2 bg-vb-primary text-white rounded-lg hover:bg-blue-600 transition-colors">
                <i class="fas fa-info-circle mr-2"></i>
                Detaylar
            </a>
            {% if subscription %}
            <a href="{% url 'tenant_subscriptions:renew' %}" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                <i class="fas fa-sync-alt mr-2"></i>
                Yenile
            </a>
            {% endif %}
            <a href="{% url 'tenant_subscriptions:upgrade' %}" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                <i class="fas fa-arrow-up mr-2"></i>
                Paket Yükselt
            </a>
        </div>
        {% else %}
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <p class="text-yellow-800">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                Paket bilgisi bulunamadı.
            </p>
        </div>
        {% endif %}
    </div>
    
    <!-- Kullanım İstatistikleri -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Limitler ve Kullanım -->
        <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
            <h3 class="text-xl font-bold text-vb-navy mb-4">
                <i class="fas fa-chart-bar mr-2 text-vb-primary"></i>
                Limitler ve Kullanım
            </h3>
            
            <div class="space-y-4">
                <!-- Hotels Modülü Limitleri -->
                {% if module_limits.hotels %}
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-semibold text-gray-700">Otel Sayısı (Hotels)</span>
                        <span class="text-sm text-gray-600">
                            {{ usage_stats.current_hotels }} / {{ limits.max_hotels|default:'-' }}
                        </span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="bg-blue-600 h-2.5 rounded-full" style="width: {{ usage_percentages.max_hotels|default:0 }}%"></div>
                    </div>
                </div>
                
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-semibold text-gray-700">Oda Sayısı (Hotels)</span>
                        <span class="text-sm text-gray-600">
                            {{ usage_stats.current_rooms }} / {{ limits.max_rooms|default:'-' }}
                        </span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="bg-green-600 h-2.5 rounded-full" style="width: {{ usage_percentages.max_rooms|default:0 }}%"></div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Tours Modülü Limitleri -->
                {% if module_limits.tours %}
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-semibold text-gray-700">Tur Sayısı (Tours)</span>
                        <span class="text-sm text-gray-600">
                            {{ usage_stats.current_tours }} / {{ limits.max_tours|default:'-' }}
                        </span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="bg-purple-600 h-2.5 rounded-full" style="width: {{ usage_percentages.max_tours|default:0 }}%"></div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Kullanıcı Sayısı (Genel) -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-semibold text-gray-700">Kullanıcı Sayısı</span>
                        <span class="text-sm text-gray-600">
                            {{ usage_stats.current_users }} / {{ limits.max_users|default:'-' }}
                        </span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="bg-indigo-600 h-2.5 rounded-full" style="width: {{ usage_percentages.max_users|default:0 }}%"></div>
                    </div>
                </div>
                
                <!-- Aylık Rezervasyon -->
                {% if limits.max_reservations_per_month %}
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-semibold text-gray-700">Aylık Rezervasyon</span>
                        <span class="text-sm text-gray-600">
                            {{ usage_stats.current_reservations_this_month }} / {{ limits.max_reservations_per_month }}
                        </span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="bg-yellow-600 h-2.5 rounded-full" style="width: {{ usage_percentages.max_reservations_per_month|default:0 }}%"></div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Paket Modülleri -->
        <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
            <h3 class="text-xl font-bold text-vb-navy mb-4">
                <i class="fas fa-puzzle-piece mr-2 text-vb-primary"></i>
                Paket Modülleri
            </h3>
            
            {% if package_modules %}
            <div class="grid grid-cols-1 gap-3">
                {% for package_module in package_modules %}
                <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-semibold text-gray-900">{{ package_module.module.name }}</p>
                            <p class="text-xs text-gray-600 mt-1">{{ package_module.module.description|truncatewords:15 }}</p>
                        </div>
                        <div class="text-green-600">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    {% if package_module.permissions %}
                    <div class="mt-2 flex flex-wrap gap-2">
                        {% for perm_key, perm_value in package_module.permissions.items %}
                        {% if perm_value %}
                        <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded">
                            {{ perm_key }}
                        </span>
                        {% endif %}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-gray-500 text-center py-4">Bu pakette modül bulunmuyor.</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Hızlı İşlemler -->
    <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
        <h3 class="text-xl font-bold text-vb-navy mb-4">
            <i class="fas fa-bolt mr-2 text-vb-primary"></i>
            Hızlı İşlemler
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <a href="{% url 'tenant_subscriptions:payment_history' %}" class="flex items-center p-4 bg-blue-50 hover:bg-blue-100 rounded-lg border border-blue-200 transition-colors">
                <i class="fas fa-receipt text-blue-600 text-2xl mr-4"></i>
                <div>
                    <p class="font-semibold text-gray-900">Ödeme Geçmişi</p>
                    <p class="text-sm text-gray-600">Faturalar ve ödemeler</p>
                </div>
            </a>
            
            <a href="{% url 'tenant_subscriptions:upgrade' %}" class="flex items-center p-4 bg-purple-50 hover:bg-purple-100 rounded-lg border border-purple-200 transition-colors">
                <i class="fas fa-arrow-up text-purple-600 text-2xl mr-4"></i>
                <div>
                    <p class="font-semibold text-gray-900">Paket Yükselt</p>
                    <p class="text-sm text-gray-600">Daha fazla özellik</p>
                </div>
            </a>
            
            {% if subscription %}
            <a href="{% url 'tenant_subscriptions:renew' %}" class="flex items-center p-4 bg-green-50 hover:bg-green-100 rounded-lg border border-green-200 transition-colors">
                <i class="fas fa-sync-alt text-green-600 text-2xl mr-4"></i>
                <div>
                    <p class="font-semibold text-gray-900">Paket Yenile</p>
                    <p class="text-sm text-gray-600">Aboneliği uzat</p>
                </div>
            </a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
