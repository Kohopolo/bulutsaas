{% extends "tenant/base.html" %}
{% load static %}

{% block title %}Paket Yönetimi - Kiracı Üye Paneli{% endblock %}
{% block page_title %}Paket Yönetimi{% endblock %}

{% block content %}
<div class="content-body">
    <!-- Paket Bilgileri Card -->
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-box"></i> Mevcut Paket
            {% if subscription %}
            <span style="margin-left: auto; padding: 4px 12px; border-radius: 3px; font-size: 11px; font-weight: 600; {% if subscription.status == 'active' %}background-color: #d4edda; color: #155724;{% elif subscription.status == 'trial' %}background-color: #fff3cd; color: #856404;{% else %}background-color: #f8d7da; color: #721c24;{% endif %}">
                {{ subscription.get_status_display }}
            </span>
            {% endif %}
        </div>
        <div class="groupbox-body">
            {% if package %}
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h3 style="font-size: 14pt; font-weight: bold; color: #2C5F8D; margin-bottom: 8px;">{{ package.name }}</h3>
                    <p style="font-size: 12px; color: #666; margin-bottom: 15px;">{{ package.description|default:"Açıklama yok" }}</p>
                    
                    <div style="margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 12px; color: #666;">Aylık Fiyat:</span>
                            <span style="font-weight: bold; color: #0078D4; font-size: 13pt;">{{ package.price_monthly }} {{ package.currency }}</span>
                        </div>
                        {% if package.price_yearly %}
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 12px; color: #666;">Yıllık Fiyat:</span>
                            <span style="font-weight: bold; color: #0078D4; font-size: 13pt;">{{ package.price_yearly }} {{ package.currency }}</span>
                        </div>
                        {% if package.get_yearly_discount_percentage %}
                        <div style="font-size: 11px; color: #28a745; margin-top: 5px;">
                            <i class="fas fa-percent"></i> Yıllık abonelikte %{{ package.get_yearly_discount_percentage }} indirim
                        </div>
                        {% endif %}
                        {% endif %}
                    </div>
                </div>
                
                <div>
                    {% if subscription %}
                    <div style="background-color: #F8F9FA; border: 1px solid #D4D4D4; border-radius: 3px; padding: 12px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div>
                                <p style="font-size: 11px; color: #666; margin-bottom: 4px;">Başlangıç Tarihi</p>
                                <p style="font-weight: 600; font-size: 12px;">{{ subscription.start_date|date:"d.m.Y" }}</p>
                            </div>
                            <div>
                                <p style="font-size: 11px; color: #666; margin-bottom: 4px;">Bitiş Tarihi</p>
                                <p style="font-weight: 600; font-size: 12px; {% if subscription.days_remaining <= 7 %}color: #dc3545;{% elif subscription.days_remaining <= 30 %}color: #ffc107;{% else %}color: #28a745;{% endif %}">
                                    {{ subscription.end_date|date:"d.m.Y" }}
                                </p>
                            </div>
                            <div>
                                <p style="font-size: 11px; color: #666; margin-bottom: 4px;">Kalan Gün</p>
                                <p style="font-weight: bold; font-size: 14pt; {% if subscription.days_remaining <= 7 %}color: #dc3545;{% elif subscription.days_remaining <= 30 %}color: #ffc107;{% else %}color: #0078D4;{% endif %}">
                                    {{ subscription.days_remaining }} gün
                                </p>
                            </div>
                            <div>
                                <p style="font-size: 11px; color: #666; margin-bottom: 4px;">Otomatik Yenileme</p>
                                <p style="font-weight: 600; font-size: 12px;">
                                    {% if subscription.auto_renew %}
                                        <i class="fas fa-check-circle" style="color: #28a745;"></i> Aktif
                                    {% else %}
                                        <i class="fas fa-times-circle" style="color: #dc3545;"></i> Pasif
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div style="background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 3px; padding: 12px;">
                        <p style="color: #856404; font-size: 12px;">
                            <i class="fas fa-exclamation-triangle"></i> Aktif abonelik bulunamadı.
                        </p>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            {% else %}
            <div style="background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 3px; padding: 12px;">
                <p style="color: #856404; font-size: 12px;">
                    <i class="fas fa-exclamation-triangle"></i> Paket bilgisi bulunamadı.
                </p>
            </div>
            {% endif %}
        </div>
    </div>
    
    
    <!-- Kullanım İstatistikleri -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
        <!-- Limitler ve Kullanım -->
        <div class="groupbox">
            <div class="groupbox-header">
                <i class="fas fa-chart-bar"></i> Limitler ve Kullanım
            </div>
            <div class="groupbox-body">
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <!-- Hotels Modülü Limitleri -->
                    {% if module_limits.hotels %}
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                            <span style="font-size: 12px; font-weight: 600; color: #333;">Otel Sayısı (Hotels)</span>
                            <span style="font-size: 12px; color: #666;">
                                {{ usage_stats.current_hotels }} / {{ limits.max_hotels|default:'-' }}
                            </span>
                        </div>
                        <div style="width: 100%; background-color: #e0e0e0; border-radius: 2px; height: 8px;">
                            <div style="background-color: #0078D4; height: 8px; border-radius: 2px; width: {{ usage_percentages.max_hotels|default:0 }}%;"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                            <span style="font-size: 12px; font-weight: 600; color: #333;">Oda Sayısı (Hotels)</span>
                            <span style="font-size: 12px; color: #666;">
                                {{ usage_stats.current_rooms }} / {{ limits.max_rooms|default:'-' }}
                            </span>
                        </div>
                        <div style="width: 100%; background-color: #e0e0e0; border-radius: 2px; height: 8px;">
                            <div style="background-color: #28a745; height: 8px; border-radius: 2px; width: {{ usage_percentages.max_rooms|default:0 }}%;"></div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Tours Modülü Limitleri -->
                    {% if module_limits.tours %}
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                            <span style="font-size: 12px; font-weight: 600; color: #333;">Tur Sayısı (Tours)</span>
                            <span style="font-size: 12px; color: #666;">
                                {{ usage_stats.current_tours }} / {{ limits.max_tours|default:'-' }}
                            </span>
                        </div>
                        <div style="width: 100%; background-color: #e0e0e0; border-radius: 2px; height: 8px;">
                            <div style="background-color: #6f42c1; height: 8px; border-radius: 2px; width: {{ usage_percentages.max_tours|default:0 }}%;"></div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Kullanıcı Sayısı (Genel) -->
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                            <span style="font-size: 12px; font-weight: 600; color: #333;">Kullanıcı Sayısı</span>
                            <span style="font-size: 12px; color: #666;">
                                {{ usage_stats.current_users }} / {{ limits.max_users|default:'-' }}
                            </span>
                        </div>
                        <div style="width: 100%; background-color: #e0e0e0; border-radius: 2px; height: 8px;">
                            <div style="background-color: #6610f2; height: 8px; border-radius: 2px; width: {{ usage_percentages.max_users|default:0 }}%;"></div>
                        </div>
                    </div>
                    
                    <!-- Aylık Rezervasyon -->
                    {% if limits.max_reservations_per_month %}
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                            <span style="font-size: 12px; font-weight: 600; color: #333;">Aylık Rezervasyon</span>
                            <span style="font-size: 12px; color: #666;">
                                {{ usage_stats.current_reservations_this_month }} / {{ limits.max_reservations_per_month }}
                            </span>
                        </div>
                        <div style="width: 100%; background-color: #e0e0e0; border-radius: 2px; height: 8px;">
                            <div style="background-color: #ffc107; height: 8px; border-radius: 2px; width: {{ usage_percentages.max_reservations_per_month|default:0 }}%;"></div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Paket Modülleri -->
        <div class="groupbox">
            <div class="groupbox-header">
                <i class="fas fa-puzzle-piece"></i> Paket Modülleri
            </div>
            <div class="groupbox-body">
                {% if package_modules %}
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    {% for package_module in package_modules %}
                    <div style="background-color: #F8F9FA; border: 1px solid #D4D4D4; border-radius: 3px; padding: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <p style="font-weight: 600; font-size: 12px; color: #333; margin-bottom: 4px;">{{ package_module.module.name }}</p>
                                <p style="font-size: 11px; color: #666;">{{ package_module.module.description|truncatewords:15 }}</p>
                            </div>
                            <div style="color: #28a745; margin-left: 10px;">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        {% if package_module.permissions %}
                        <div style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 4px;">
                            {% for perm_key, perm_value in package_module.permissions.items %}
                            {% if perm_value %}
                            <span style="padding: 2px 6px; background-color: #cfe2ff; color: #084298; font-size: 10px; border-radius: 2px;">
                                {{ perm_key }}
                            </span>
                            {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p style="text-align: center; color: #666; padding: 20px; font-size: 12px;">Bu pakette modül bulunmuyor.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Hızlı İşlemler -->
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-bolt"></i> Hızlı İşlemler
        </div>
        <div class="groupbox-body">
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                <a href="{% url 'tenant_subscriptions:details' %}" class="vb-button primary" style="padding: 8px 16px; font-size: 12px;">
                    <i class="fas fa-info-circle"></i> Detaylar
                </a>
                <a href="{% url 'tenant_subscriptions:payment_history' %}" class="vb-button primary" style="padding: 8px 16px; font-size: 12px;">
                    <i class="fas fa-receipt"></i> Ödeme Geçmişi
                </a>
                <a href="{% url 'tenant_subscriptions:upgrade' %}" class="vb-button primary" style="padding: 8px 16px; font-size: 12px;">
                    <i class="fas fa-arrow-up"></i> Paket Yükselt
                </a>
                {% if subscription %}
                <a href="{% url 'tenant_subscriptions:renew' %}" class="vb-button success" style="padding: 8px 16px; font-size: 12px;">
                    <i class="fas fa-sync-alt"></i> Paket Yenile
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
