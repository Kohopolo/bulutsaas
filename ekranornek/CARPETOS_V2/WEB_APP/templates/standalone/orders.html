<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarpetOS HalÄ± YÄ±kama Otomasyonu - SipariÅŸler</title>
    <link rel="stylesheet" href="common.css">
</head>
<body>
    <div class="menu-strip">
        <span class="menu-item">Dosya</span>
        <span class="menu-item">MÃ¼ÅŸteri Ä°ÅŸlemler</span>
        <span class="menu-item">Raporlar</span>
        <span class="menu-item">Ayarlar</span>
        <span class="menu-item">YardÄ±m</span>
        <span class="menu-right">SMS Bakiyesi: 1.250</span>
    </div>

    <div class="header-panel">
        <div class="header-top">
            <div class="header-title">CARPETOS HALI YIKAMA OTOMASYONU</div>
            <div class="header-license">LÄ°SANS SAHÄ°BÄ°: ADA HALI YIKAMA</div>
        </div>
        <div class="header-banner">SipariÅŸ YÃ¶netimi</div>
    </div>

    <div class="main-layout">
        <div class="left-panel">
            <div class="panel-title">TOPLAM: <span id="totalOrders">0</span> KAYIT</div>
            <table class="customer-table">
                <thead>
                    <tr>
                        <th>MÅ. NO</th>
                        <th>CARÄ° ADI</th>
                    </tr>
                </thead>
                <tbody id="customersTableBody">
                    <tr>
                        <td colspan="2" class="text-center">YÃ¼kleniyor...</td>
                    </tr>
                </tbody>
            </table>
            <input type="text" class="search-box" placeholder="Ara..." id="searchInput">
            <div class="recent-calls">
                <div class="recent-calls-title">SON Ã‡AÄRILAR</div>
                <div id="recentCalls">-</div>
            </div>
            <div class="action-buttons">
                <button class="btn btn-success" onclick="refreshOrders()">ğŸ”„ Yenile</button>
                <button class="btn btn-primary" onclick="searchOrders()">ğŸ” Ara</button>
                <button class="btn btn-danger" onclick="deleteOrder()">ğŸ—‘ï¸ Sil</button>
            </div>
        </div>

        <div class="center-panel">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('orders')">SÄ°PARÄ°ÅLER</div>
                <div class="tab" onclick="switchTab('washing')">YIKAMADA OLANLAR</div>
                <div class="tab" onclick="switchTab('due')">TESLÄ°M ZAMANI GELENLER</div>
                <div class="tab" onclick="switchTab('delivery')">TESLÄ°MAT LÄ°STESÄ°</div>
                <div class="tab" onclick="switchTab('delivered')">TESLÄ°M EDÄ°LENLER</div>
                <div class="tab" onclick="switchTab('pending')">BEKLEYEN TESLÄ°MAT</div>
                <div class="tab" onclick="switchTab('cancelled')">Ä°PTAL</div>
                <div class="tab" onclick="switchTab('agenda')">AJANDA</div>
            </div>

            <div class="date-navigation">
                <button class="date-nav-btn" onclick="changeDate(-1)">â—€</button>
                <input type="date" class="date-picker" id="datePicker" value="">
                <button class="date-nav-btn" onclick="changeDate(1)">â–¶</button>
                <select class="date-picker" id="vehicleFilter">
                    <option value="">TÃ¼m AraÃ§lar</option>
                    <option value="AraÃ§ 1">AraÃ§ 1</option>
                    <option value="AraÃ§ 2">AraÃ§ 2</option>
                </select>
                <button class="btn btn-primary" onclick="fetchOrders()">Getir</button>
            </div>

            <table class="orders-table">
                <thead>
                    <tr>
                        <th>â˜‘</th>
                        <th>MU.NO</th>
                        <th>FÄ°Å</th>
                        <th>CARÄ° ADI</th>
                        <th>BÃ–LGE</th>
                        <th>AÃ‡IKLAMA</th>
                        <th>ARAÃ‡</th>
                        <th>SAAT</th>
                        <th>ALIÅ SAAT</th>
                        <th>ADET</th>
                        <th>MÂ²</th>
                        <th>TUTAR</th>
                    </tr>
                </thead>
                <tbody id="ordersTableBody">
                    <tr>
                        <td colspan="12" class="text-center">YÃ¼kleniyor...</td>
                    </tr>
                </tbody>
            </table>

            <div class="summary-panel">
                <div class="summary-item">
                    <div class="summary-label">TOPLAM TESLÄ°M ALINACAK</div>
                    <div class="summary-value" id="totalToDeliver">0 ADET</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">TESLÄ°M ALINAN HALI ADEDÄ°</div>
                    <div class="summary-value" id="pickedUpCount">0 ADET</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">TESLÄ°M ALINAN TOPLAM MÂ²</div>
                    <div class="summary-value" id="pickedUpM2">0 MÂ²</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">TESLÄ°M ALINANLAR TUTARI</div>
                    <div class="summary-value" id="pickedUpAmount">0.00 â‚º</div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="shortcut-btn" title="Bilgisayar" onclick="window.location.href='dashboard.html'">ğŸ–¥ï¸</div>
            <div class="shortcut-btn" title="Online SipariÅŸ" onclick="alert('Online SipariÅŸ')">ğŸ“±</div>
            <div class="shortcut-btn" title="Telefon" onclick="alert('Telefon')">ğŸ“</div>
            <div class="shortcut-btn" title="MÃ¼ÅŸteri YÃ¶netimi" onclick="window.location.href='customers.html'">ğŸ‘¥</div>
            <div class="shortcut-btn" title="Yeni Ekle" onclick="showAddModal()">â•</div>
            <div class="shortcut-btn" title="Raporlar" onclick="window.location.href='reports.html'">ğŸ“Š</div>
        </div>
    </div>

    <div class="footer-panel">
        <div class="footer-icon" title="Yenile" onclick="refreshPage()">ğŸ”„</div>
        <div class="footer-icon" title="Ara" onclick="showSearch()">ğŸ”</div>
        <div class="footer-icon" title="Sil" onclick="deleteSelected()">ğŸ—‘ï¸</div>
        <div class="footer-icon" title="Bilgi" onclick="showInfo()">â„¹ï¸</div>
        <div class="footer-icon" title="YardÄ±m" onclick="showHelp()">â“</div>
        <div class="footer-icon" title="Ayarlar" onclick="window.location.href='settings.html'">âš™ï¸</div>
        <div class="footer-icon" title="Mesajlar" onclick="showMessages()">ğŸ’¬</div>
        <div class="footer-icon" title="HesaplayÄ±cÄ±" onclick="showCalculator()">ğŸ”¢</div>
        <div class="footer-icon" title="KullanÄ±cÄ±" onclick="showUserMenu()">ğŸ‘¤</div>
        <div class="footer-icon" title="Tema" onclick="toggleTheme()">ğŸ¨</div>
        <div class="footer-icon" title="BaÄŸlantÄ±" onclick="checkConnection()">ğŸ“¡</div>
        <div class="footer-icon" title="Finans" onclick="showFinance()">ğŸ’°</div>
        <div class="status-label" id="statusLabel">API BaÄŸlÄ±</div>
    </div>

    <script>
        let orders = [];
        let currentTab = 'orders';
        
        function switchTab(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            loadOrders();
        }
        
        function changeDate(days) {
            const dateInput = document.getElementById('datePicker');
            const currentDate = new Date(dateInput.value || new Date());
            currentDate.setDate(currentDate.getDate() + days);
            dateInput.value = currentDate.toISOString().split('T')[0];
            fetchOrders();
        }
        
        async function loadOrders() {
            try {
                const response = await fetch('/api/orders');
                const data = await response.json();
                if (data.success) {
                    orders = data.data;
                    renderOrders(orders);
                    updateSummary();
                    document.getElementById('totalOrders').textContent = orders.length;
                }
            } catch (error) {
                console.error('Error loading orders:', error);
            }
        }
        
        function renderOrders(orderList) {
            const tbody = document.getElementById('ordersTableBody');
            if (orderList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="12" class="text-center">SipariÅŸ bulunamadÄ±</td></tr>';
                return;
            }
            
            tbody.innerHTML = orderList.map(order => `
                <tr onclick="selectOrder(${order.id})">
                    <td><input type="checkbox" onclick="event.stopPropagation()"></td>
                    <td>${order.customer_id || ''}</td>
                    <td>${order.order_number || ''}</td>
                    <td>${order.customer_name || ''}</td>
                    <td>${order.region || ''}</td>
                    <td>${order.description || ''}</td>
                    <td>${order.vehicle || ''}</td>
                    <td>${order.time ? new Date(order.time).toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'}) : ''}</td>
                    <td>${order.pickup_time ? new Date(order.pickup_time).toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'}) : ''}</td>
                    <td>${order.quantity || 0}</td>
                    <td>${order.square_meters || 0}</td>
                    <td>${order.amount ? order.amount.toFixed(2) + ' â‚º' : '0.00 â‚º'}</td>
                </tr>
            `).join('');
        }
        
        function updateSummary() {
            const totalToDeliver = orders.filter(o => o.status === 'pending').length;
            const pickedUp = orders.filter(o => o.status === 'picked_up');
            const pickedUpCount = pickedUp.length;
            const pickedUpM2 = pickedUp.reduce((sum, o) => sum + (o.square_meters || 0), 0);
            const pickedUpAmount = pickedUp.reduce((sum, o) => sum + (o.amount || 0), 0);
            
            document.getElementById('totalToDeliver').textContent = totalToDeliver + ' ADET';
            document.getElementById('pickedUpCount').textContent = pickedUpCount + ' ADET';
            document.getElementById('pickedUpM2').textContent = pickedUpM2.toFixed(1) + ' MÂ²';
            document.getElementById('pickedUpAmount').textContent = pickedUpAmount.toFixed(2) + ' â‚º';
        }
        
        function selectOrder(id) {
            document.querySelectorAll('.orders-table tbody tr').forEach(tr => tr.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
        }
        
        function fetchOrders() {
            loadOrders();
        }
        
        function refreshOrders() {
            loadOrders();
        }
        
        function searchOrders() {
            document.getElementById('searchInput').focus();
        }
        
        function deleteOrder() {
            const selected = document.querySelector('.orders-table tbody tr.selected');
            if (selected) {
                if (confirm('SeÃ§ili sipariÅŸi silmek istediÄŸinize emin misiniz?')) {
                    // Delete implementation
                }
            } else {
                alert('LÃ¼tfen silmek iÃ§in bir sipariÅŸ seÃ§in');
            }
        }
        
        function refreshPage() {
            location.reload();
        }
        
        function showSearch() {
            document.getElementById('searchInput').focus();
        }
        
        function deleteSelected() {
            alert('SeÃ§ili Ã¶ÄŸeler silinecek');
        }
        
        function showInfo() {
            alert('CarpetOS v2.0\nHalÄ± YÄ±kama Ä°ÅŸletme YÃ¶netim Sistemi');
        }
        
        function showHelp() {
            alert('YardÄ±m sayfasÄ± aÃ§Ä±lacak');
        }
        
        function showMessages() {
            alert('Mesajlar');
        }
        
        function showCalculator() {
            alert('HesaplayÄ±cÄ±');
        }
        
        function showUserMenu() {
            alert('KullanÄ±cÄ± menÃ¼sÃ¼');
        }
        
        function toggleTheme() {
            alert('Tema deÄŸiÅŸtirilecek');
        }
        
        function checkConnection() {
            document.getElementById('statusLabel').textContent = 'BaÄŸlantÄ± kontrol ediliyor...';
            setTimeout(() => {
                document.getElementById('statusLabel').textContent = 'API BaÄŸlÄ±';
            }, 1000);
        }
        
        function showFinance() {
            alert('Finans modÃ¼lÃ¼');
        }
        
        function showAddModal() {
            alert('Yeni sipariÅŸ ekleme formu aÃ§Ä±lacak');
        }
        
        // Set today's date as default
        document.getElementById('datePicker').valueAsDate = new Date();
        loadOrders();
    </script>
</body>
</html>

