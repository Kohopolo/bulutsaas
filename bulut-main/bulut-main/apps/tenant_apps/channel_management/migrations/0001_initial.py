# Generated by Django 4.2.11 on 2025-11-13 20:58

from decimal import Decimal
import django.core.validators
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('hotels', '0004_hotelextraservice'),
        ('reception', '0004_add_voucher_payment_fields'),
        ('tenants', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='ChannelConfiguration',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Oluşturulma Tarihi')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Güncellenme Tarihi')),
                ('is_deleted', models.BooleanField(default=False, verbose_name='Silinmiş mi?')),
                ('deleted_at', models.DateTimeField(blank=True, null=True, verbose_name='Silinme Tarihi')),
                ('name', models.CharField(help_text='Bu tenant için görünecek isim', max_length=200, verbose_name='Kanal Adı')),
                ('api_credentials', models.JSONField(default=dict, help_text='API key, secret, username, password vb.', verbose_name='API Bilgileri')),
                ('api_endpoint', models.CharField(blank=True, max_length=500, verbose_name='API Endpoint')),
                ('api_timeout', models.IntegerField(default=30, verbose_name='API Timeout (saniye)')),
                ('api_retry_count', models.IntegerField(default=3, verbose_name='API Retry Sayısı')),
                ('sync_enabled', models.BooleanField(default=True, verbose_name='Senkronizasyon Aktif')),
                ('sync_interval', models.IntegerField(default=60, help_text='Otomatik senkronizasyon için', verbose_name='Senkronizasyon Aralığı (dakika)')),
                ('last_sync_at', models.DateTimeField(blank=True, null=True, verbose_name='Son Senkronizasyon')),
                ('next_sync_at', models.DateTimeField(blank=True, null=True, verbose_name='Sonraki Senkronizasyon')),
                ('auto_sync_pricing', models.BooleanField(default=True, verbose_name='Otomatik Fiyat Senkronizasyonu')),
                ('auto_sync_availability', models.BooleanField(default=True, verbose_name='Otomatik Müsaitlik Senkronizasyonu')),
                ('price_markup_percent', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Kanal fiyatına eklenecek yüzde', max_digits=5, verbose_name='Fiyat Artış Oranı (%)')),
                ('price_markup_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Kanal fiyatına eklenecek sabit tutar', max_digits=10, verbose_name='Fiyat Artış Tutarı')),
                ('commission_rate', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.00')), django.core.validators.MaxValueValidator(Decimal('100.00'))], verbose_name='Komisyon Oranı (%)')),
                ('commission_calculation', models.CharField(choices=[('percentage', 'Yüzde'), ('fixed', 'Sabit Tutar'), ('tiered', 'Kademeli')], default='percentage', max_length=20, verbose_name='Komisyon Hesaplama')),
                ('auto_confirm_reservations', models.BooleanField(default=False, verbose_name='Otomatik Rezervasyon Onayı')),
                ('reservation_timeout', models.IntegerField(default=15, help_text='Rezervasyon onayı için süre', verbose_name='Rezervasyon Timeout (dakika)')),
                ('allow_modifications', models.BooleanField(default=True, verbose_name='Değişikliklere İzin Ver')),
                ('allow_cancellations', models.BooleanField(default=True, verbose_name='İptallere İzin Ver')),
                ('is_active', models.BooleanField(default=True, verbose_name='Aktif mi?')),
                ('is_test_mode', models.BooleanField(default=True, help_text='Test ortamında çalıştır', verbose_name='Test Modu')),
                ('notes', models.TextField(blank=True, verbose_name='Notlar')),
                ('hotel', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='channel_configurations', to='hotels.hotel', verbose_name='Otel')),
            ],
            options={
                'verbose_name': 'Kanal Konfigürasyonu',
                'verbose_name_plural': 'Kanal Konfigürasyonları',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ChannelTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Oluşturulma Tarihi')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Güncellenme Tarihi')),
                ('is_deleted', models.BooleanField(default=False, verbose_name='Silinmiş mi?')),
                ('deleted_at', models.DateTimeField(blank=True, null=True, verbose_name='Silinme Tarihi')),
                ('name', models.CharField(max_length=200, verbose_name='Kanal Adı')),
                ('code', models.SlugField(unique=True, verbose_name='Kanal Kodu')),
                ('channel_type', models.CharField(choices=[('ota', 'OTA (Online Travel Agency)'), ('gds', 'GDS (Global Distribution System)'), ('metasearch', 'Meta Arama Motoru'), ('direct', 'Direkt Rezervasyon'), ('other', 'Diğer')], default='ota', max_length=20, verbose_name='Kanal Tipi')),
                ('description', models.TextField(blank=True, verbose_name='Açıklama')),
                ('api_type', models.CharField(default='xml', help_text='xml, json, soap, rest vb.', max_length=50, verbose_name='API Tipi')),
                ('api_documentation_url', models.URLField(blank=True, verbose_name='API Dokümantasyon URL')),
                ('api_endpoint_template', models.CharField(blank=True, help_text='Örn: https://api.booking.com/v1/{endpoint}', max_length=500, verbose_name='API Endpoint Şablonu')),
                ('required_fields', models.JSONField(default=dict, help_text='{"api_key": "API Key", "api_secret": "API Secret"}', verbose_name='Gerekli Alanlar')),
                ('optional_fields', models.JSONField(default=dict, help_text='{"hotel_id": "Otel ID", "username": "Kullanıcı Adı"}', verbose_name='Opsiyonel Alanlar')),
                ('supports_pricing', models.BooleanField(default=True, verbose_name='Fiyat Aktarımı Desteği')),
                ('supports_availability', models.BooleanField(default=True, verbose_name='Müsaitlik Aktarımı Desteği')),
                ('supports_reservations', models.BooleanField(default=True, verbose_name='Rezervasyon Desteği')),
                ('supports_two_way', models.BooleanField(default=True, help_text='Hem push hem pull desteği', verbose_name='İki Yönlü Senkronizasyon')),
                ('supports_commission', models.BooleanField(default=True, verbose_name='Komisyon Yönetimi')),
                ('default_commission_rate', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.00')), django.core.validators.MaxValueValidator(Decimal('100.00'))], verbose_name='Varsayılan Komisyon Oranı (%)')),
                ('is_active', models.BooleanField(default=True, verbose_name='Aktif mi?')),
                ('is_popular', models.BooleanField(default=False, verbose_name='Popüler mi?')),
                ('sort_order', models.IntegerField(default=0, verbose_name='Sıralama')),
                ('icon', models.CharField(default='fas fa-globe', help_text='Font Awesome class', max_length=50, verbose_name='İkon')),
                ('logo_url', models.URLField(blank=True, verbose_name='Logo URL')),
            ],
            options={
                'verbose_name': 'Kanal Şablonu',
                'verbose_name_plural': 'Kanal Şablonları',
                'ordering': ['sort_order', 'name'],
                'indexes': [models.Index(fields=['code'], name='channel_man_code_c87ac9_idx'), models.Index(fields=['channel_type'], name='channel_man_channel_a42125_idx'), models.Index(fields=['is_active'], name='channel_man_is_acti_96c58f_idx')],
            },
        ),
        migrations.CreateModel(
            name='ChannelReservation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Oluşturulma Tarihi')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Güncellenme Tarihi')),
                ('is_deleted', models.BooleanField(default=False, verbose_name='Silinmiş mi?')),
                ('deleted_at', models.DateTimeField(blank=True, null=True, verbose_name='Silinme Tarihi')),
                ('channel_reservation_id', models.CharField(db_index=True, max_length=200, verbose_name='Kanal Rezervasyon ID')),
                ('channel_reservation_code', models.CharField(blank=True, max_length=200, verbose_name='Kanal Rezervasyon Kodu')),
                ('guest_name', models.CharField(max_length=200, verbose_name='Misafir Adı')),
                ('guest_email', models.EmailField(blank=True, max_length=254, verbose_name='Misafir E-posta')),
                ('guest_phone', models.CharField(blank=True, max_length=50, verbose_name='Misafir Telefon')),
                ('check_in_date', models.DateField(verbose_name='Check-in Tarihi')),
                ('check_out_date', models.DateField(verbose_name='Check-out Tarihi')),
                ('adult_count', models.IntegerField(default=1, verbose_name='Yetişkin Sayısı')),
                ('child_count', models.IntegerField(default=0, verbose_name='Çocuk Sayısı')),
                ('room_type_name', models.CharField(max_length=200, verbose_name='Oda Tipi Adı')),
                ('room_number', models.CharField(blank=True, max_length=50, verbose_name='Oda Numarası')),
                ('total_amount', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Toplam Tutar')),
                ('currency', models.CharField(default='TRY', max_length=3, verbose_name='Para Birimi')),
                ('commission_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, verbose_name='Komisyon Tutarı')),
                ('status', models.CharField(choices=[('pending', 'Beklemede'), ('confirmed', 'Onaylandı'), ('cancelled', 'İptal Edildi'), ('modified', 'Değiştirildi'), ('no_show', 'Gelmedi'), ('checked_in', 'Check-In Yapıldı'), ('checked_out', 'Check-Out Yapıldı')], default='pending', max_length=20, verbose_name='Durum')),
                ('reservation_date', models.DateTimeField(blank=True, null=True, verbose_name='Rezervasyon Tarihi')),
                ('confirmation_date', models.DateTimeField(blank=True, null=True, verbose_name='Onay Tarihi')),
                ('cancellation_date', models.DateTimeField(blank=True, null=True, verbose_name='İptal Tarihi')),
                ('special_requests', models.TextField(blank=True, verbose_name='Özel İstekler')),
                ('channel_data', models.JSONField(blank=True, default=dict, help_text='Kanalın gönderdiği ham veri', verbose_name='Kanal Verisi')),
                ('notes', models.TextField(blank=True, verbose_name='Notlar')),
                ('configuration', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reservations', to='channel_management.channelconfiguration', verbose_name='Kanal Konfigürasyonu')),
                ('system_reservation', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='channel_reservations', to='reception.reservation', verbose_name='Sistem Rezervasyonu')),
            ],
            options={
                'verbose_name': 'Kanal Rezervasyonu',
                'verbose_name_plural': 'Kanal Rezervasyonları',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ChannelPricing',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Oluşturulma Tarihi')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Güncellenme Tarihi')),
                ('is_deleted', models.BooleanField(default=False, verbose_name='Silinmiş mi?')),
                ('deleted_at', models.DateTimeField(blank=True, null=True, verbose_name='Silinme Tarihi')),
                ('start_date', models.DateField(db_index=True, verbose_name='Başlangıç Tarihi')),
                ('end_date', models.DateField(db_index=True, verbose_name='Bitiş Tarihi')),
                ('base_price', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Temel Fiyat')),
                ('channel_price', models.DecimalField(decimal_places=2, help_text='Kanala gönderilecek fiyat (markup dahil)', max_digits=10, verbose_name='Kanal Fiyatı')),
                ('currency', models.CharField(default='TRY', max_length=3, verbose_name='Para Birimi')),
                ('availability', models.IntegerField(default=0, help_text='Müsait oda sayısı', verbose_name='Müsaitlik')),
                ('min_stay', models.IntegerField(default=1, verbose_name='Minimum Kalış')),
                ('max_stay', models.IntegerField(blank=True, null=True, verbose_name='Maksimum Kalış')),
                ('cancellation_policy', models.CharField(blank=True, max_length=50, verbose_name='İptal Politikası')),
                ('free_cancellation_until', models.DateField(blank=True, null=True, verbose_name='Ücretsiz İptal Tarihi')),
                ('is_active', models.BooleanField(default=True, verbose_name='Aktif mi?')),
                ('last_synced_at', models.DateTimeField(blank=True, null=True, verbose_name='Son Senkronizasyon')),
                ('channel_data', models.JSONField(blank=True, default=dict, verbose_name='Kanal Verisi')),
                ('configuration', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='pricings', to='channel_management.channelconfiguration', verbose_name='Kanal Konfigürasyonu')),
                ('room', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='channel_pricings', to='hotels.room', verbose_name='Oda Tipi')),
            ],
            options={
                'verbose_name': 'Kanal Fiyatı',
                'verbose_name_plural': 'Kanal Fiyatları',
                'ordering': ['-start_date'],
            },
        ),
        migrations.AddField(
            model_name='channelconfiguration',
            name='template',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='configurations', to='channel_management.channeltemplate', verbose_name='Kanal Şablonu'),
        ),
        migrations.AddField(
            model_name='channelconfiguration',
            name='tenant',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='channel_configurations', to='tenants.tenant', verbose_name='Tenant'),
        ),
        migrations.CreateModel(
            name='ChannelCommission',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Oluşturulma Tarihi')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Güncellenme Tarihi')),
                ('commission_rate', models.DecimalField(decimal_places=2, max_digits=5, verbose_name='Komisyon Oranı (%)')),
                ('base_amount', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Temel Tutar')),
                ('commission_amount', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Komisyon Tutarı')),
                ('currency', models.CharField(default='TRY', max_length=3, verbose_name='Para Birimi')),
                ('commission_date', models.DateField(default=django.utils.timezone.now, verbose_name='Komisyon Tarihi')),
                ('payment_date', models.DateField(blank=True, null=True, verbose_name='Ödeme Tarihi')),
                ('is_paid', models.BooleanField(default=False, verbose_name='Ödendi mi?')),
                ('payment_reference', models.CharField(blank=True, max_length=200, verbose_name='Ödeme Referansı')),
                ('notes', models.TextField(blank=True, verbose_name='Notlar')),
                ('configuration', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='commissions', to='channel_management.channelconfiguration', verbose_name='Kanal Konfigürasyonu')),
                ('reservation', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='commissions', to='channel_management.channelreservation', verbose_name='Rezervasyon')),
            ],
            options={
                'verbose_name': 'Kanal Komisyonu',
                'verbose_name_plural': 'Kanal Komisyonları',
                'ordering': ['-commission_date'],
            },
        ),
        migrations.CreateModel(
            name='ChannelSync',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Oluşturulma Tarihi')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Güncellenme Tarihi')),
                ('sync_type', models.CharField(choices=[('pricing', 'Fiyat Senkronizasyonu'), ('availability', 'Müsaitlik Senkronizasyonu'), ('reservation', 'Rezervasyon Senkronizasyonu'), ('inventory', 'Envanter Senkronizasyonu'), ('full', 'Tam Senkronizasyon')], default='full', max_length=20, verbose_name='Senkronizasyon Tipi')),
                ('direction', models.CharField(choices=[('push', 'Push (Sistemden Kanala)'), ('pull', 'Pull (Kanaldan Sisteme)'), ('bidirectional', 'İki Yönlü')], default='bidirectional', max_length=20, verbose_name='Yön')),
                ('status', models.CharField(choices=[('pending', 'Beklemede'), ('running', 'Çalışıyor'), ('completed', 'Tamamlandı'), ('failed', 'Başarısız'), ('partial', 'Kısmi Başarılı')], default='pending', max_length=20, verbose_name='Durum')),
                ('total_items', models.IntegerField(default=0, verbose_name='Toplam Öğe')),
                ('successful_items', models.IntegerField(default=0, verbose_name='Başarılı Öğe')),
                ('failed_items', models.IntegerField(default=0, verbose_name='Başarısız Öğe')),
                ('started_at', models.DateTimeField(blank=True, null=True, verbose_name='Başlangıç Zamanı')),
                ('completed_at', models.DateTimeField(blank=True, null=True, verbose_name='Bitiş Zamanı')),
                ('duration_seconds', models.IntegerField(blank=True, null=True, verbose_name='Süre (saniye)')),
                ('error_message', models.TextField(blank=True, verbose_name='Hata Mesajı')),
                ('error_details', models.JSONField(blank=True, default=dict, verbose_name='Hata Detayları')),
                ('result_data', models.JSONField(blank=True, default=dict, verbose_name='Sonuç Verisi')),
                ('configuration', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='syncs', to='channel_management.channelconfiguration', verbose_name='Kanal Konfigürasyonu')),
            ],
            options={
                'verbose_name': 'Kanal Senkronizasyonu',
                'verbose_name_plural': 'Kanal Senkronizasyonları',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['configuration', '-created_at'], name='channel_man_configu_c774b9_idx'), models.Index(fields=['status'], name='channel_man_status_1eaf39_idx'), models.Index(fields=['sync_type'], name='channel_man_sync_ty_365b3c_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='channelreservation',
            index=models.Index(fields=['configuration', '-created_at'], name='channel_man_configu_46cf74_idx'),
        ),
        migrations.AddIndex(
            model_name='channelreservation',
            index=models.Index(fields=['channel_reservation_id'], name='channel_man_channel_4ed965_idx'),
        ),
        migrations.AddIndex(
            model_name='channelreservation',
            index=models.Index(fields=['status'], name='channel_man_status_08d953_idx'),
        ),
        migrations.AddIndex(
            model_name='channelreservation',
            index=models.Index(fields=['check_in_date', 'check_out_date'], name='channel_man_check_i_5510b9_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='channelreservation',
            unique_together={('configuration', 'channel_reservation_id')},
        ),
        migrations.AddIndex(
            model_name='channelpricing',
            index=models.Index(fields=['configuration', 'room'], name='channel_man_configu_a7f435_idx'),
        ),
        migrations.AddIndex(
            model_name='channelpricing',
            index=models.Index(fields=['start_date', 'end_date'], name='channel_man_start_d_045f6b_idx'),
        ),
        migrations.AddIndex(
            model_name='channelpricing',
            index=models.Index(fields=['is_active'], name='channel_man_is_acti_0d8b2a_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='channelpricing',
            unique_together={('configuration', 'room', 'start_date', 'end_date')},
        ),
        migrations.AddIndex(
            model_name='channelconfiguration',
            index=models.Index(fields=['tenant', 'template'], name='channel_man_tenant__a680c2_idx'),
        ),
        migrations.AddIndex(
            model_name='channelconfiguration',
            index=models.Index(fields=['hotel'], name='channel_man_hotel_i_f947bf_idx'),
        ),
        migrations.AddIndex(
            model_name='channelconfiguration',
            index=models.Index(fields=['is_active'], name='channel_man_is_acti_dd3181_idx'),
        ),
        migrations.AddIndex(
            model_name='channelconfiguration',
            index=models.Index(fields=['sync_enabled'], name='channel_man_sync_en_88e4c0_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='channelconfiguration',
            unique_together={('tenant', 'template', 'hotel')},
        ),
        migrations.AddIndex(
            model_name='channelcommission',
            index=models.Index(fields=['configuration', '-commission_date'], name='channel_man_configu_28cf0c_idx'),
        ),
        migrations.AddIndex(
            model_name='channelcommission',
            index=models.Index(fields=['is_paid'], name='channel_man_is_paid_6c652a_idx'),
        ),
        migrations.AddIndex(
            model_name='channelcommission',
            index=models.Index(fields=['reservation'], name='channel_man_reserva_696db3_idx'),
        ),
    ]
