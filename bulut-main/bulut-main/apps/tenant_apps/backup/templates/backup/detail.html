{% extends "tenant/base.html" %}
{% load static %}

{% block title %}Yedekleme Detayı{% endblock %}

{% block content %}
<div class="content-body">
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-database"></i> Yedekleme Detayı
            <div style="float: right;">
                <a href="{% url 'backup:backup_list' %}" class="vb-button">
                    <i class="fas fa-arrow-left"></i> Geri
                </a>
                {% if backup.status == 'completed' and file_exists %}
                <a href="{% url 'backup:backup_download' backup.pk %}" class="vb-button success">
                    <i class="fas fa-download"></i> İndir
                </a>
                {% endif %}
            </div>
        </div>
        <div class="groupbox-body">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <!-- Sol Kolon -->
                <div>
                    <div class="form-groupbox">
                        <div class="groupbox-header">Genel Bilgiler</div>
                        <div class="groupbox-body">
                            <table class="vb-table" style="margin: 0;">
                                <tr>
                                    <td style="width: 150px; font-weight: bold;">Dosya Adı:</td>
                                    <td>{{ backup.file_name }}</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;">Tip:</td>
                                    <td>
                                        <span class="badge badge-{% if backup.backup_type == 'automatic' %}info{% else %}primary{% endif %}">
                                            {{ backup.get_backup_type_display }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;">Durum:</td>
                                    <td>
                                        <span class="badge badge-{% if backup.status == 'completed' %}success{% elif backup.status == 'failed' %}danger{% elif backup.status == 'in_progress' %}warning{% else %}secondary{% endif %}">
                                            {{ backup.get_status_display }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;">Dosya Boyutu:</td>
                                    <td>{{ file_size }}</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;">Dosya Durumu:</td>
                                    <td>
                                        {% if file_exists %}
                                        <span class="badge badge-success">Mevcut</span>
                                        {% else %}
                                        <span class="badge badge-danger">Bulunamadı</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Sağ Kolon -->
                <div>
                    <div class="form-groupbox">
                        <div class="groupbox-header">Zaman Bilgileri</div>
                        <div class="groupbox-body">
                            <table class="vb-table" style="margin: 0;">
                                <tr>
                                    <td style="width: 150px; font-weight: bold;">Başlatan:</td>
                                    <td>{{ backup.started_by.get_full_name|default:"Sistem" }}</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;">Başlangıç:</td>
                                    <td>{{ backup.started_at|date:"d.m.Y H:i:s" }}</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;">Tamamlanma:</td>
                                    <td>{{ backup.completed_at|date:"d.m.Y H:i:s"|default:"-" }}</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;">Süre:</td>
                                    <td>{{ backup.get_duration_display }}</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;">Oluşturulma:</td>
                                    <td>{{ backup.created_at|date:"d.m.Y H:i:s" }}</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;">Güncelleme:</td>
                                    <td>{{ backup.updated_at|date:"d.m.Y H:i:s" }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hata Mesajı -->
            {% if backup.error_message %}
            <div class="form-groupbox" style="margin-top: 20px;">
                <div class="groupbox-header" style="background: #f8d7da; color: #721c24;">Hata Mesajı</div>
                <div class="groupbox-body">
                    <pre style="white-space: pre-wrap; color: #721c24;">{{ backup.error_message }}</pre>
                </div>
            </div>
            {% endif %}

            <!-- Notlar -->
            {% if backup.notes %}
            <div class="form-groupbox" style="margin-top: 20px;">
                <div class="groupbox-header">Notlar</div>
                <div class="groupbox-body">
                    <p>{{ backup.notes|linebreaks }}</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

