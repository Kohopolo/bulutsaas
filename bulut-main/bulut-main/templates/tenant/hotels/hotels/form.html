{% extends "tenant/base.html" %}
{% load static %}

{% block title %}{% if hotel %}Otel Düzenle{% else %}Yeni Otel Ekle{% endif %} - Kiracı Üye Paneli{% endblock %}
{% block page_title %}{% if hotel %}Otel Düzenle{% else %}Yeni Otel Ekle{% endif %}{% endblock %}

{% block content %}
<div class="p-6">
    <!-- Geri Dön Butonu -->
    <div class="mb-4">
        <a href="{% url 'hotels:hotel_list' %}" class="text-vb-primary hover:text-blue-600">
            <i class="fas fa-arrow-left mr-2"></i>
            Otel Listesine Dön
        </a>
    </div>
    
    <!-- Otel Formu -->
    <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
        <h2 class="text-2xl font-bold text-vb-navy mb-6">
            <i class="fas fa-{% if hotel %}edit{% else %}plus{% endif %} mr-2 text-vb-primary"></i>
            {% if hotel %}Otel Düzenle{% else %}Yeni Otel Ekle{% endif %}
        </h2>
        
        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            <!-- Temel Bilgiler -->
            <div class="border-b border-gray-200 pb-6">
<h3 class="vb-section-title text-gray-900 mb-4">Temel Bilgiler</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Otel Adı *</label>
                        {{ form.name }}
                        {% if form.name.errors %}
                        <p class="text-red-600 text-xs mt-1">{{ form.name.errors.0 }}</p>
                        {% endif %}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Otel Kodu *</label>
                        {{ form.code }}
                        {% if form.code.errors %}
                        <p class="text-red-600 text-xs mt-1">{{ form.code.errors.0 }}</p>
                        {% endif %}
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Açıklama</label>
                        {{ form.description }}
                    </div>
                </div>
            </div>
            
            <!-- Kategoriler -->
            <div class="border-b border-gray-200 pb-6">
<h3 class="vb-section-title text-gray-900 mb-4">Kategoriler</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Bölge</label>
                        {{ form.region }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Şehir</label>
                        {{ form.city }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Otel Türü</label>
                        {{ form.hotel_type }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Yıldız</label>
                        {{ form.star_rating }}
                    </div>
                </div>
            </div>
            
            <!-- İletişim Bilgileri -->
            <div class="border-b border-gray-200 pb-6">
<h3 class="vb-section-title text-gray-900 mb-4">İletişim Bilgileri</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">E-posta</label>
                        {{ form.email }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Telefon</label>
                        {{ form.phone }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">WhatsApp</label>
                        {{ form.whatsapp }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Telegram</label>
                        {{ form.telegram }}
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Web Sitesi</label>
                        {{ form.website }}
                    </div>
                </div>
            </div>
            
            <!-- Adres Bilgileri -->
            <div class="border-b border-gray-200 pb-6">
<h3 class="vb-section-title text-gray-900 mb-4">Adres Bilgileri</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Adres *</label>
                        {{ form.address }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">İlçe</label>
                        {{ form.district }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Posta Kodu</label>
                        {{ form.postal_code }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Ülke</label>
                        {{ form.country }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Enlem</label>
                        {{ form.latitude }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Boylam</label>
                        {{ form.longitude }}
                    </div>
                </div>
            </div>
            
            <!-- Otel Özellikleri -->
            <div class="border-b border-gray-200 pb-6">
<h3 class="vb-section-title text-gray-900 mb-4">Otel Özellikleri</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Toplam Oda Sayısı</label>
                        {{ form.total_rooms }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Toplam Yatak Sayısı</label>
                        {{ form.total_beds }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Check-in Saati</label>
                        {{ form.check_in_time }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Check-out Saati</label>
                        {{ form.check_out_time }}
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Otel Özellikleri</label>
                        {{ form.hotel_features }}
                        <p class="text-xs text-gray-500 mt-1">Ctrl tuşu ile birden fazla seçim yapabilirsiniz</p>
                    </div>
                </div>
            </div>
            
            <!-- Görsel İçerik -->
            <div class="border-b border-gray-200 pb-6">
<h3 class="vb-section-title text-gray-900 mb-4">Görsel İçerik</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Ana Sayfa Resmi</label>
                        {{ form.main_image }}
                        {% if hotel and hotel.main_image %}
                        <div class="mt-2">
                            <img src="{{ hotel.main_image.url }}" alt="{{ hotel.name }}" class="w-32 h-32 object-cover rounded-lg">
                        </div>
                        {% endif %}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Logo</label>
                        {{ form.logo }}
                        {% if hotel and hotel.logo %}
                        <div class="mt-2">
                            <img src="{{ hotel.logo.url }}" alt="Logo" class="w-32 h-32 object-contain rounded-lg bg-gray-100 p-2">
                        </div>
                        {% endif %}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Favicon</label>
                        {{ form.favicon }}
                        {% if hotel and hotel.favicon %}
                        <div class="mt-2">
                            <img src="{{ hotel.favicon.url }}" alt="Favicon" class="w-16 h-16 object-contain rounded-lg bg-gray-100 p-2">
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Galeri -->
            {% if hotel %}
            <div class="border-b border-gray-200 pb-6">
<h3 class="vb-section-title text-gray-900 mb-4">Otel Galerisi</h3>
                <div id="hotel-gallery-container" data-hotel-id="{{ hotel.pk }}">
                    <!-- Drag & Drop Zone -->
                    <div id="hotel-gallery-dropzone" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center mb-4 hover:border-vb-primary transition-colors cursor-pointer">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                        <p class="text-gray-600 font-semibold mb-1">Resimleri buraya sürükleyip bırakın</p>
                        <p class="text-gray-500 text-sm mb-3">veya</p>
                        <label for="hotel-gallery-upload" class="inline-block px-4 py-2 bg-vb-primary text-white rounded-lg hover:bg-blue-600 transition-colors cursor-pointer">
                            <i class="fas fa-folder-open mr-2"></i>
                            Dosya Seç
                        </label>
                        <input type="file" id="hotel-gallery-upload" multiple accept="image/*" class="hidden">
                        <p class="text-xs text-gray-400 mt-2">JPG, PNG, GIF formatları desteklenir (Maksimum 10MB)</p>
                    </div>
                    
                    <!-- Galeri Grid -->
                    <div id="hotel-gallery-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                        {% for image in gallery_images %}
                        <div class="gallery-item relative group" data-image-id="{{ image.pk }}">
                            <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden border-2 border-gray-200">
                                <img src="{{ image.image.url }}" alt="{{ image.title|default:image.image.name }}" class="w-full h-full object-cover">
                            </div>
                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all rounded-lg flex items-center justify-center opacity-0 group-hover:opacity-100">
                                <div class="flex space-x-2">
                                    <button type="button" class="gallery-edit-btn px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700" data-image-id="{{ image.pk }}" title="Düzenle">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" class="gallery-delete-btn px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700" data-image-id="{{ image.pk }}" title="Sil">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="absolute top-1 left-1 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded cursor-move" title="Sürükle">
                                <i class="fas fa-grip-vertical"></i>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Upload Progress -->
                    <div id="hotel-gallery-progress" class="hidden mt-4">
                        <div class="bg-gray-200 rounded-full h-2">
                            <div id="hotel-gallery-progress-bar" class="bg-vb-primary h-2 rounded-full transition-all" style="width: 0%"></div>
                        </div>
                        <p id="hotel-gallery-progress-text" class="text-sm text-gray-600 mt-2 text-center"></p>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Detay Bilgileri -->
            <div class="border-b border-gray-200 pb-6">
<h3 class="vb-section-title text-gray-900 mb-4">Detay Bilgileri</h3>
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Detay Açıklama</label>
                        {{ form.detail_description }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Otel Politikaları</label>
                        {{ form.policies }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Konsept Açıklama</label>
                        {{ form.concept_description }}
                    </div>
                </div>
            </div>
            
            <!-- Video -->
            <div class="border-b border-gray-200 pb-6">
<h3 class="vb-section-title text-gray-900 mb-4">Video</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">YouTube Video Linki</label>
                        {{ form.youtube_video_url }}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Video Dosyası</label>
                        {{ form.video_file }}
                    </div>
                </div>
            </div>
            
            <!-- Hizmetler ve Olanaklar -->
            <div class="border-b border-gray-200 pb-6">
<h3 class="vb-section-title text-gray-900 mb-4">Hizmetler ve Olanaklar</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Hizmetler</label>
                        {{ form.services_json }}
                        {% if form.services_json.help_text %}
                        <p class="text-xs text-gray-500 mt-1">{{ form.services_json.help_text }}</p>
                        {% endif %}
                        {% if form.services_json.errors %}
                        <p class="text-red-600 text-xs mt-1">{{ form.services_json.errors.0 }}</p>
                        {% endif %}
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Olanaklar</label>
                        {{ form.amenities_json }}
                        {% if form.amenities_json.help_text %}
                        <p class="text-xs text-gray-500 mt-1">{{ form.amenities_json.help_text }}</p>
                        {% endif %}
                        {% if form.amenities_json.errors %}
                        <p class="text-red-600 text-xs mt-1">{{ form.amenities_json.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Sosyal Medya -->
            <div class="border-b border-gray-200 pb-6">
<h3 class="vb-section-title text-gray-900 mb-4">Sosyal Medya</h3>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Sosyal Medya Hesapları</label>
                    {{ form.social_media_json }}
                    {% if form.social_media_json.help_text %}
                    <p class="text-xs text-gray-500 mt-1">{{ form.social_media_json.help_text }}</p>
                    {% endif %}
                    {% if form.social_media_json.errors %}
                    <p class="text-red-600 text-xs mt-1">{{ form.social_media_json.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Durum -->
            <div class="pb-6">
<h3 class="vb-section-title text-gray-900 mb-4">Durum</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="flex items-center">
                        {{ form.is_active }}
                        <label class="ml-2 text-sm font-semibold text-gray-700">Aktif mi?</label>
                    </div>
                    <div class="flex items-center">
                        {{ form.is_featured }}
                        <label class="ml-2 text-sm font-semibold text-gray-700">Öne Çıkan mı?</label>
                    </div>
                    <div class="flex items-center">
                        {{ form.is_homepage_visible }}
                        <label class="ml-2 text-sm font-semibold text-gray-700">Anasayfada Görünür mü?</label>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Sıralama</label>
                        {{ form.sort_order }}
                    </div>
                </div>
            </div>
            
            <!-- Butonlar -->
            <div class="flex justify-end space-x-3 pt-4">
                <a href="{% url 'hotels:hotel_list' %}" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors font-semibold">
                    İptal
                </a>
                <button type="submit" class="px-6 py-2 bg-vb-primary text-white rounded-lg hover:bg-blue-600 transition-colors font-semibold">
                    <i class="fas fa-save mr-2"></i>
                    {% if hotel %}Güncelle{% else %}Kaydet{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extrajs %}
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script src="{% static 'js/gallery_manager.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    {% if hotel %}
    // Otel galeri yönetimi
    const hotelGallery = new GalleryManager({
        containerId: 'hotel-gallery-container',
        dropzoneId: 'hotel-gallery-dropzone',
        uploadInputId: 'hotel-gallery-upload',
        gridId: 'hotel-gallery-grid',
        progressId: 'hotel-gallery-progress',
        progressBarId: 'hotel-gallery-progress-bar',
        progressTextId: 'hotel-gallery-progress-text',
        uploadUrl: '{% url "hotels:api_hotel_image_upload" hotel.pk %}',
        deleteUrl: '{% url "hotels:api_hotel_image_delete" 0 %}'.replace('0', ''),
        updateUrl: '{% url "hotels:api_hotel_image_update" 0 %}'.replace('0', ''),
        reorderUrl: '{% url "hotels:api_hotel_images_reorder" %}',
        csrfToken: '{{ csrf_token }}',
        type: 'hotel'
    });
    hotelGallery.init();
    {% endif %}
});
</script>
{% endblock %}

{% block extrastyle %}
<link rel="stylesheet" href="{% static 'css/gallery_manager.css' %}">
<style>
    .form-control {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        background-color: #ffffff;
        color: #1f2937;
        font-size: 0.875rem;
    }
    .form-control:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    textarea.form-control {
        resize: vertical;
    }
</style>
{% endblock %}

