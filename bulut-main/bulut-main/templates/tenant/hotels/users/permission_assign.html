{% extends "tenant/base.html" %}
{% load static %}
{% load dict_filters %}

{% block title %}Otel Yetkisi Ata - {{ tenant_user.user.get_full_name }}{% endblock %}
{% block page_title %}Otel Yetkisi Ata{% endblock %}

{% block content %}
<div class="p-6">
    <div class="mb-4">
        <a href="{% url 'tenant:user_detail' tenant_user.pk %}" class="text-vb-primary hover:text-blue-600">
            <i class="fas fa-arrow-left mr-2"></i>
            Kullanıcı Detayına Dön
        </a>
    </div>
    
    <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
        <h2 class="text-2xl font-bold text-vb-navy mb-4">
            <i class="fas fa-hotel mr-2 text-vb-primary"></i>
            {{ tenant_user.user.get_full_name }} - Otel Yetkisi Ata
        </h2>
        
        <form method="post" class="space-y-4">
            {% csrf_token %}
            
            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                <p class="text-sm text-gray-600 mb-2">
                    <i class="fas fa-info-circle mr-2"></i>
                    Kullanıcıya erişim vermek istediğiniz otelleri seçin ve yetki seviyesini belirleyin.
                </p>
                <ul class="text-xs text-gray-500 list-disc list-inside space-y-1">
                    <li><strong>Görüntüleme:</strong> Sadece otel bilgilerini görüntüleyebilir</li>
                    <li><strong>Yönetim:</strong> Otel bilgilerini düzenleyebilir, oda ve fiyat yönetimi yapabilir</li>
                    <li><strong>Yönetici:</strong> Tüm yetkilere sahiptir, otel ayarlarını değiştirebilir</li>
                </ul>
            </div>
            
            <div class="space-y-3">
                {% for hotel in hotels %}
                <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" 
                                   name="hotels" 
                                   value="{{ hotel.id }}" 
                                   id="hotel_{{ hotel.id }}"
                                   {% if hotel.id in current_permissions %}checked{% endif %}
                                   class="w-5 h-5 text-vb-primary border-gray-300 rounded focus:ring-vb-primary">
                            <label for="hotel_{{ hotel.id }}" class="font-semibold text-gray-900 cursor-pointer">
                                <i class="fas fa-hotel mr-2 text-vb-primary"></i>
                                {{ hotel.name }}
                            </label>
                        </div>
                        <div class="flex items-center space-x-2">
                            <select name="permission_level_{{ hotel.id }}" 
                                    id="permission_{{ hotel.id }}"
                                    class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-vb-primary focus:border-transparent"
                                    {% if hotel.id not in current_permissions %}disabled{% endif %}>
                                <option value="view" {% if current_permissions|get_item:hotel.id == 'view' %}selected{% endif %}>Görüntüleme</option>
                                <option value="manage" {% if current_permissions|get_item:hotel.id == 'manage' %}selected{% endif %}>Yönetim</option>
                                <option value="admin" {% if current_permissions|get_item:hotel.id == 'admin' %}selected{% endif %}>Yönetici</option>
                            </select>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <p class="text-yellow-800">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Henüz otel bulunmamaktadır. Önce otel ekleyin.
                    </p>
                </div>
                {% endfor %}
            </div>
            
            <div class="flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200">
                <a href="{% url 'tenant:user_detail' tenant_user.pk %}" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                    <i class="fas fa-times mr-2"></i>İptal
                </a>
                <button type="submit" class="px-4 py-2 bg-vb-primary text-white rounded-lg hover:bg-blue-600">
                    <i class="fas fa-save mr-2"></i>Kaydet
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Checkbox değiştiğinde select'i aktif/pasif yap
    document.querySelectorAll('input[type="checkbox"][name="hotels"]').forEach(function(checkbox) {
        checkbox.addEventListener('change', function() {
            const select = document.getElementById('permission_' + this.value);
            if (this.checked) {
                select.disabled = false;
            } else {
                select.disabled = true;
            }
        });
    });
</script>
{% endblock %}

