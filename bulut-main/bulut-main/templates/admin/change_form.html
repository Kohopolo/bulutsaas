{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrastyle %}
{{ block.super }}
<style>
    /* VB Desktop Form Style - Grid Layout */
    .form-field {
        display: flex;
        flex-direction: column;
    }
    
    .form-field input[type="text"],
    .form-field input[type="email"],
    .form-field input[type="password"],
    .form-field input[type="number"],
    .form-field input[type="date"],
    .form-field input[type="time"],
    .form-field input[type="url"],
    .form-field input[type="search"],
    .form-field select,
    .form-field textarea {
        width: 100%;
        border: 1px solid #dee2e6;
        border-radius: 3px;
        padding: 6px 10px;
        font-size: 13px;
        transition: all 0.2s;
        min-height: 36px;
    }
    
    .form-field textarea {
        min-height: 80px;
        resize: vertical;
    }
    
    .form-field.col-span-full {
        grid-column: 1 / -1;
    }
    
    .form-field input:focus,
    .form-field select:focus,
    .form-field textarea:focus {
        border-color: #3498db;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        outline: none;
    }
    
    /* Form Field Animations */
    .form-field {
        animation: fadeIn 0.3s ease-in;
    }
    
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(5px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Required Field Indicator */
    .form-field label:has(+ input[required]),
    .form-field label:has(+ select[required]),
    .form-field label:has(+ textarea[required]) {
        position: relative;
    }
    
    /* Tooltip for help text */
    .help {
        position: relative;
    }
    
    .help:hover::after {
        content: attr(data-help);
        position: absolute;
        bottom: 100%;
        left: 0;
        background: #333;
        color: white;
        padding: 4px 8px;
        border-radius: 3px;
        font-size: 11px;
        white-space: nowrap;
        z-index: 1000;
    }
    
    .form-field.errors input,
    .form-field.errors select,
    .form-field.errors textarea {
        border-color: #e74c3c;
    }
    
    .form-field .errorlist {
        color: #e74c3c;
        font-size: 12px;
        margin-top: 4px;
        list-style: none;
        padding: 0;
    }
    
    .form-field .errorlist li {
        padding: 2px 0;
    }
    
    /* Full width fields (textarea, etc.) */
    .form-field.field-description,
    .form-field.field-notes,
    .form-field.field-content,
    .form-field.field-body {
        grid-column: 1 / -1;
    }
    
    /* Checkbox fields */
    .form-field input[type="checkbox"] {
        width: auto;
        margin-right: 8px;
    }
    
    .submit-row {
        padding: 16px;
        background: #f8f9fa;
        border-top: 1px solid #dee2e6;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .submit-row input {
        padding: 7px 16px;
        border-radius: 3px;
        border: 1px solid;
        cursor: pointer;
    }
    
    .submit-row input[type="submit"] {
        background: #3498db;
        color: white;
        border-color: #3498db;
    }
    
    .submit-row input[type="submit"]:hover {
        background: #2980b9;
        border-color: #2980b9;
    }
    
    .submit-row .deletelink {
        background: #e74c3c;
        color: white;
        border-color: #e74c3c;
        padding: 7px 16px;
        border-radius: 3px;
        text-decoration: none;
    }
    
    .submit-row .deletelink:hover {
        background: #c0392b;
        border-color: #c0392b;
    }
</style>
{% endblock %}

{% block content %}
<div class="bg-white rounded-vb border border-gray-200">
    <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
        <h2 class="text-lg font-semibold text-vb-navy-500">
            {% if add %}Yeni {{ opts.verbose_name }} Ekle{% else %}{{ original|truncatewords:"18" }} Düzenle{% endif %}
        </h2>
        {% block object-tools %}
        {% if change and not is_popup %}
        <div class="flex items-center space-x-2">
            <a href="{% url opts|admin_urlname:'history' original.pk|admin_urlquote %}" class="px-3 py-2 bg-gray-100 text-gray-700 rounded-vb hover:bg-gray-200 text-sm">
                <i class="fas fa-history mr-2"></i>
                Geçmiş
            </a>
            {% if has_absolute_url %}
            <a href="{{ absolute_url }}" target="_blank" class="px-3 py-2 bg-vb-primary text-white rounded-vb hover:bg-blue-600 text-sm">
                <i class="fas fa-external-link-alt mr-2"></i>
                Görüntüle
            </a>
            {% endif %}
        </div>
        {% endif %}
        {% endblock %}
    </div>
    
    <form {% if has_file_field %}enctype="multipart/form-data" {% endif %}action="{{ form_url }}" method="post" id="{{ opts.model_name }}_form" novalidate>
        {% csrf_token %}
        
        <div class="p-6">
            {% block form_top %}{% endblock %}
            
            <div>
                {% if is_popup %}<input type="hidden" name="{{ is_popup_var }}" value="1">{% endif %}
                {% if to_field %}<input type="hidden" name="{{ to_field_var }}" value="{{ to_field }}">{% endif %}
                {% if save_on_top %}{% block submit_buttons_top %}{% submit_row %}{% endblock %}{% endif %}
                
                {% if adminform.form.non_field_errors %}
                    <div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-vb">
                        <p class="font-semibold mb-2 text-red-800">Lütfen aşağıdaki hataları düzeltin:</p>
                        <ul class="list-disc list-inside text-red-700">
                            {% for error in adminform.form.non_field_errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
                
                {% if adminform.form.errors %}
                    <div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-vb">
                        <p class="font-semibold mb-2 text-red-800">Form hataları (alan bazlı hatalar aşağıda gösterilecektir):</p>
                        <ul class="list-disc list-inside text-red-700">
                            {% for field_name, error_list in adminform.form.errors.items %}
                            <li>
                                <strong>{{ field_name|capfirst }}:</strong>
                                {% for error in error_list %}
                                    {{ error }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
                
                {% block field_sets %}
                {% for fieldset in adminform %}
                    {% include "admin/includes/fieldset.html" %}
                {% endfor %}
                {% endblock %}
                
                {% block after_field_sets %}{% endblock %}
                
                {% block inline_field_sets %}
                {% for inline_admin_formset in inline_admin_formsets %}
                    {% include inline_admin_formset.opts.template %}
                {% endfor %}
                {% endblock %}
                
                {% block after_related_objects %}{% endblock %}
                
                {% block submit_buttons_bottom %}
                {% submit_row %}
                {% endblock %}
                
                {% block admin_change_form_document_ready %}
                <script id="django-admin-form-add-constants" src="{% static 'admin/js/change_form.js' %}" {% if adminform and add %}data-model-name="{{ opts.model_name }}"{% endif %} async></script>
                {% endblock %}
                
                {# JavaScript for prepopulated fields #}
                {% prepopulated_fields_js %}
            </div>
        </div>
    </form>
</div>
{% endblock %}
