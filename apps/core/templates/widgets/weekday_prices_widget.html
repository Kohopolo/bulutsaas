{% load static %}
{% load dict_filters %}
<div id="{{ widget.attrs.id }}_container" class="json-widget weekday-prices-widget">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        {% for day_key, day_label in widget.weekdays %}
        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">{{ day_label }}</label>
            <input type="number" 
                   step="0.01" 
                   min="0"
                   name="{{ widget.name }}_{{ day_key }}"
                   value="{{ widget.prices|get_item:day_key|default:'' }}" 
                   class="weekday-price form-control" 
                   placeholder="0.00">
        </div>
        {% endfor %}
    </div>
    <input type="hidden" id="{{ widget.attrs.id }}_json" name="{{ widget.name }}" value="{{ widget.value|default:'{}' }}">
</div>

<script>
(function() {
    const container = document.getElementById('{{ widget.attrs.id }}_container');
    if (!container) return;
    
    const hiddenInput = document.getElementById('{{ widget.attrs.id }}_json');
    const priceInputs = container.querySelectorAll('.weekday-price');
    
    function updateHiddenInput() {
        const prices = {};
        priceInputs.forEach(input => {
            const dayKey = input.name.replace('{{ widget.name }}_', '');
            const value = input.value.trim();
            if (value) {
                try {
                    prices[dayKey] = parseFloat(value);
                } catch {
                    // Hata durumunda atla
                }
            }
        });
        hiddenInput.value = JSON.stringify(prices);
    }
    
    priceInputs.forEach(input => {
        input.addEventListener('input', updateHiddenInput);
    });
    
    // İlk yüklemede güncelle
    updateHiddenInput();
})();
</script>

