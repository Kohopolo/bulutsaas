{% extends "tenant/base.html" %}
{% load static %}

{% block title %}Kanal Rezervasyonu Detayı{% endblock %}

{% block content %}
<div class="content-body">
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-calendar-check"></i> Kanal Rezervasyonu Detayı
            <div style="float: right;">
                <a href="{% url 'channel_management:reservation_list' %}" class="vb-button">
                    <i class="fas fa-arrow-left"></i> Geri
                </a>
            </div>
        </div>
        <div class="groupbox-body">
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                <!-- Sol Kolon -->
                <div>
                    <div class="form-groupbox" style="margin-bottom: 20px;">
                        <div class="groupbox-header">
                            <i class="fas fa-info-circle"></i> Rezervasyon Bilgileri
                        </div>
                        <div class="groupbox-body">
                            <div class="form-group">
                                <label><strong>Kanal:</strong></label>
                                <p><i class="{{ reservation.configuration.template.icon }}"></i> {{ reservation.configuration.name }}</p>
                            </div>
                            <div class="form-group">
                                <label><strong>Rezervasyon Kodu:</strong></label>
                                <p><strong>{{ reservation.channel_reservation_code|default:reservation.channel_reservation_id }}</strong></p>
                            </div>
                            <div class="form-group">
                                <label><strong>Durum:</strong></label>
                                <p>
                                    {% if reservation.status == 'confirmed' %}
                                    <span style="display: inline-block; padding: 3px 8px; background: #28a745; color: white; border-radius: 3px; font-size: 11px; font-weight: bold;">Onaylandı</span>
                                    {% elif reservation.status == 'pending' %}
                                    <span style="display: inline-block; padding: 3px 8px; background: #ffc107; color: #333; border-radius: 3px; font-size: 11px; font-weight: bold;">Beklemede</span>
                                    {% elif reservation.status == 'cancelled' %}
                                    <span style="display: inline-block; padding: 3px 8px; background: #dc3545; color: white; border-radius: 3px; font-size: 11px; font-weight: bold;">İptal Edildi</span>
                                    {% else %}
                                    <span style="display: inline-block; padding: 3px 8px; background: #6c757d; color: white; border-radius: 3px; font-size: 11px; font-weight: bold;">{{ reservation.get_status_display }}</span>
                                    {% endif %}
                                </p>
                            </div>
                            <div class="form-group">
                                <label><strong>Rezervasyon Tarihi:</strong></label>
                                <p>{{ reservation.reservation_date|date:"d.m.Y H:i"|default:"-" }}</p>
                            </div>
                            {% if reservation.confirmation_date %}
                            <div class="form-group">
                                <label><strong>Onay Tarihi:</strong></label>
                                <p>{{ reservation.confirmation_date|date:"d.m.Y H:i" }}</p>
                            </div>
                            {% endif %}
                            {% if reservation.cancellation_date %}
                            <div class="form-group">
                                <label><strong>İptal Tarihi:</strong></label>
                                <p>{{ reservation.cancellation_date|date:"d.m.Y H:i" }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-groupbox" style="margin-bottom: 20px;">
                        <div class="groupbox-header">
                            <i class="fas fa-user"></i> Misafir Bilgileri
                        </div>
                        <div class="groupbox-body">
                            <div class="form-group">
                                <label><strong>Ad Soyad:</strong></label>
                                <p>{{ reservation.guest_name }}</p>
                            </div>
                            {% if reservation.guest_email %}
                            <div class="form-group">
                                <label><strong>E-posta:</strong></label>
                                <p>{{ reservation.guest_email }}</p>
                            </div>
                            {% endif %}
                            {% if reservation.guest_phone %}
                            <div class="form-group">
                                <label><strong>Telefon:</strong></label>
                                <p>{{ reservation.guest_phone }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-groupbox">
                        <div class="groupbox-header">
                            <i class="fas fa-bed"></i> Oda Bilgileri
                        </div>
                        <div class="groupbox-body">
                            <div class="form-group">
                                <label><strong>Oda Tipi:</strong></label>
                                <p>{{ reservation.room_type_name }}</p>
                            </div>
                            {% if reservation.room_number %}
                            <div class="form-group">
                                <label><strong>Oda Numarası:</strong></label>
                                <p>{{ reservation.room_number }}</p>
                            </div>
                            {% endif %}
                            <div class="form-group">
                                <label><strong>Yetişkin Sayısı:</strong></label>
                                <p>{{ reservation.adult_count }}</p>
                            </div>
                            <div class="form-group">
                                <label><strong>Çocuk Sayısı:</strong></label>
                                <p>{{ reservation.child_count }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sağ Kolon -->
                <div>
                    <div class="form-groupbox" style="margin-bottom: 20px;">
                        <div class="groupbox-header">
                            <i class="fas fa-calendar"></i> Tarih Bilgileri
                        </div>
                        <div class="groupbox-body">
                            <div class="form-group">
                                <label><strong>Check-in Tarihi:</strong></label>
                                <p style="font-size: 16px; font-weight: bold; color: #2c5f8d;">{{ reservation.check_in_date|date:"d.m.Y" }}</p>
                            </div>
                            <div class="form-group">
                                <label><strong>Check-out Tarihi:</strong></label>
                                <p style="font-size: 16px; font-weight: bold; color: #2c5f8d;">{{ reservation.check_out_date|date:"d.m.Y" }}</p>
                            </div>
                            <div class="form-group">
                                <label><strong>Gece Sayısı:</strong></label>
                                <p>{{ reservation.check_out_date|timesince:reservation.check_in_date|default:"-" }}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-groupbox" style="margin-bottom: 20px;">
                        <div class="groupbox-header">
                            <i class="fas fa-money-bill-wave"></i> Fiyat Bilgileri
                        </div>
                        <div class="groupbox-body">
                            <div class="form-group">
                                <label><strong>Toplam Tutar:</strong></label>
                                <p style="font-size: 18px; font-weight: bold; color: #2c5f8d;">{{ reservation.total_amount|floatformat:2 }} {{ reservation.currency }}</p>
                            </div>
                            <div class="form-group">
                                <label><strong>Komisyon Tutarı:</strong></label>
                                <p style="font-size: 16px; font-weight: bold; color: #dc3545;">{{ reservation.commission_amount|floatformat:2 }} {{ reservation.currency }}</p>
                            </div>
                        </div>
                    </div>
                    
                    {% if reservation.special_requests %}
                    <div class="form-groupbox" style="margin-bottom: 20px;">
                        <div class="groupbox-header">
                            <i class="fas fa-comment"></i> Özel İstekler
                        </div>
                        <div class="groupbox-body">
                            <p>{{ reservation.special_requests }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if reservation.notes %}
                    <div class="form-groupbox">
                        <div class="groupbox-header">
                            <i class="fas fa-sticky-note"></i> Notlar
                        </div>
                        <div class="groupbox-body">
                            <p>{{ reservation.notes }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Komisyon Kayıtları -->
            {% if commissions %}
            <div class="form-groupbox" style="margin-top: 20px;">
                <div class="groupbox-header">
                    <i class="fas fa-percent"></i> Komisyon Kayıtları
                </div>
                <div class="groupbox-body">
                    <div class="datagrid">
                        <div class="vb-datagrid-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tarih</th>
                                        <th>Komisyon Oranı</th>
                                        <th>Temel Tutar</th>
                                        <th>Komisyon Tutarı</th>
                                        <th>Ödeme Durumu</th>
                                        <th>Ödeme Tarihi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for commission in commissions %}
                                    <tr>
                                        <td>{{ commission.commission_date|date:"d.m.Y" }}</td>
                                        <td>{{ commission.commission_rate }}%</td>
                                        <td>{{ commission.base_amount|floatformat:2 }} {{ commission.currency }}</td>
                                        <td><strong>{{ commission.commission_amount|floatformat:2 }} {{ commission.currency }}</strong></td>
                                        <td>
                                            {% if commission.is_paid %}
                                            <span style="display: inline-block; padding: 3px 8px; background: #28a745; color: white; border-radius: 3px; font-size: 11px; font-weight: bold;">Ödendi</span>
                                            {% else %}
                                            <span style="display: inline-block; padding: 3px 8px; background: #ffc107; color: #333; border-radius: 3px; font-size: 11px; font-weight: bold;">Ödenmedi</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ commission.payment_date|date:"d.m.Y"|default:"-" }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Sistem Rezervasyonu -->
            {% if reservation.system_reservation %}
            <div class="form-groupbox" style="margin-top: 20px;">
                <div class="groupbox-header">
                    <i class="fas fa-link"></i> Sistem Rezervasyonu
                </div>
                <div class="groupbox-body">
                    <p>
                        Bu kanal rezervasyonu sistem rezervasyonu ile bağlantılı:
                        <a href="{% url 'reception:reservation_detail' reservation.system_reservation.pk %}" class="vb-button" style="margin-left: 10px;">
                            <i class="fas fa-external-link-alt"></i> Rezervasyonu Görüntüle
                        </a>
                    </p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}





