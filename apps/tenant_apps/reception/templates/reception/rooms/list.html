{% extends "tenant/base.html" %}
{% load static %}
{% load dict_filters %}

{% block title %}Oda Listesi - Resepsiyon{% endblock %}

{% block content %}
<div class="p-6">
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-vb-navy">
            <i class="fas fa-bed mr-2 text-vb-primary"></i>
            Oda Listesi
        </h2>
        <div class="flex space-x-3">
            <a href="{% url 'reception:room_rack' %}" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                <i class="fas fa-th-large mr-2"></i>
                Oda Durum Panosu
            </a>
            <a href="{% url 'reception:dashboard' %}" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm">
                <i class="fas fa-arrow-left mr-2"></i>
                Ana Ekran
            </a>
        </div>
    </div>
    
    <div class="bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden">
        {% if room_data %}
        <div class="overflow-x-auto">
            <table class="w-full border-collapse">
                <thead class="bg-gray-50 border-b-2 border-gray-200">
                    <tr>
                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Oda Numarası</th>
                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Oda Tipi</th>
                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Durum</th>
                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">İşlemler</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in room_data %}
                    {% with room=item.room_number %}
                    <tr class="border-b border-gray-100 hover:bg-gray-50 {% if item.is_available %}cursor-pointer transition-colors{% endif %}" 
                        {% if item.is_available %}onclick="window.location.href='{% url 'reception:reservation_create' %}?room={{ room.room.id }}'"{% endif %}>
                        <td class="px-4 py-3 text-sm font-semibold text-gray-900 {% if item.is_available %}hover:text-green-600{% endif %}">{{ room.number }}</td>
                        <td class="px-4 py-3 text-sm text-gray-600 {% if item.is_available %}hover:text-green-600{% endif %}">{{ room.room.name }}</td>
                        <td class="px-4 py-3">
                            {% if item.is_available %}
                            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded font-semibold">
                                <i class="fas fa-check-circle mr-1"></i>Müsait - Rezervasyon için tıklayın
                            </span>
                            {% elif room.status == 'occupied' %}
                            <span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded">Dolu</span>
                            {% elif room.status == 'housekeeping' %}
                            <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">Temizlik</span>
                            {% elif room.status == 'maintenance' %}
                            <span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded">Bakım</span>
                            {% else %}
                            <span class="px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded">{{ room.get_status_display }}</span>
                            {% endif %}
                        </td>
                        <td class="px-4 py-3" onclick="{% if item.is_available %}event.stopPropagation();{% endif %}">
                            {% if item.is_available %}
                            <a href="{% url 'reception:reservation_create' %}?room={{ room.room.id }}" 
                               class="text-green-600 hover:text-green-700 font-semibold inline-flex items-center px-3 py-1.5 bg-green-50 rounded-lg hover:bg-green-100 transition-colors" 
                               title="Rezervasyon Ekle">
                                <i class="fas fa-plus-circle mr-1"></i>Rezervasyon Yap
                            </a>
                            {% else %}
                            {% with reservation=room_reservations|get_item:room.id %}
                            {% if reservation %}
                            <div class="flex space-x-2">
                                {% if reservation.status == 'confirmed' %}
                                <a href="{% url 'reception:reservation_checkin' reservation.pk %}" 
                                   class="text-green-600 hover:text-green-700 px-3 py-1.5 bg-green-50 rounded-lg hover:bg-green-100 transition-colors inline-flex items-center text-sm font-semibold" 
                                   title="Check-in">
                                    <i class="fas fa-sign-in-alt mr-1"></i>Check-in
                                </a>
                                {% elif reservation.status == 'checked_in' %}
                                <a href="{% url 'reception:reservation_checkout' reservation.pk %}" 
                                   class="text-orange-600 hover:text-orange-700 px-3 py-1.5 bg-orange-50 rounded-lg hover:bg-orange-100 transition-colors inline-flex items-center text-sm font-semibold" 
                                   title="Check-out">
                                    <i class="fas fa-sign-out-alt mr-1"></i>Check-out
                                </a>
                                {% endif %}
                                <a href="{% url 'reception:reservation_detail' reservation.pk %}" 
                                   class="text-vb-primary hover:text-blue-600 px-3 py-1.5 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors inline-flex items-center text-sm" 
                                   title="Rezervasyon Detayı">
                                    <i class="fas fa-eye mr-1"></i>Detay
                                </a>
                            </div>
                            {% else %}
                            <a href="{% url 'reception:room_detail' room.pk %}" class="text-vb-primary hover:text-blue-600 px-3 py-1.5 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors inline-flex items-center" title="Oda Detayı">
                                <i class="fas fa-eye mr-1"></i>Detay
                            </a>
                            {% endif %}
                            {% endwith %}
                            {% endif %}
                        </td>
                    </tr>
                    {% endwith %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-12">
            <i class="fas fa-bed text-6xl text-gray-300 mb-4"></i>
            <p class="text-gray-600">Henüz oda bulunamadı.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

