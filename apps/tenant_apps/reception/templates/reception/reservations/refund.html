{% extends "tenant/base.html" %}
{% load static %}

{% block title %}Rezervasyon İadesi - {{ reservation.reservation_code }}{% endblock %}

{% block content %}
<div class="content-body">
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-undo"></i> Rezervasyon İadesi: {{ reservation.reservation_code }}
            <div style="float: right;">
                <a href="{% url 'reception:reservation_detail' reservation.pk %}" class="vb-button">
                    <i class="fas fa-arrow-left"></i> Geri
                </a>
            </div>
        </div>
        <div class="groupbox-body">
            <!-- Rezervasyon Özeti -->
            <div class="form-groupbox" style="margin-bottom: 20px;">
                <div class="groupbox-header">
                    <i class="fas fa-info-circle"></i> Rezervasyon Özeti
                </div>
                <div class="groupbox-body">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div>
                            <strong>Müşteri:</strong> {{ reservation.customer.get_full_name }}
                        </div>
                        <div>
                            <strong>Toplam Tutar:</strong> {{ reservation.total_amount|floatformat:2 }} {{ reservation.currency }}
                        </div>
                        <div>
                            <strong>Ödenen Tutar:</strong> {{ reservation.total_paid|floatformat:2 }} {{ reservation.currency }}
                        </div>
                        <div>
                            <strong>Kalan Tutar:</strong> {{ reservation.get_remaining_amount|floatformat:2 }} {{ reservation.currency }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- İade Formu -->
            <form method="post" class="form-groupbox">
                {% csrf_token %}
                <div class="groupbox-header">
                    <i class="fas fa-money-bill-wave"></i> İade Bilgileri
                </div>
                <div class="groupbox-body">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div class="form-group">
                            <label>İade Tutarı <span class="text-red-500">*</span></label>
                            <input type="number" name="refund_amount" step="0.01" min="0.01" max="{{ reservation.total_paid|floatformat:2 }}" 
                                   value="{{ reservation.total_paid|floatformat:2 }}" required class="form-control"
                                   placeholder="0.00">
                            <small style="color: #666;">Maksimum iade tutarı: {{ reservation.total_paid|floatformat:2 }} {{ reservation.currency }}</small>
                        </div>
                        <div class="form-group">
                            <label>İade Yöntemi <span class="text-red-500">*</span></label>
                            <select name="refund_method" required class="form-control">
                                <option value="">Seçiniz...</option>
                                <option value="cash">Nakit</option>
                                <option value="credit_card">Kredi Kartı</option>
                                <option value="debit_card">Banka Kartı</option>
                                <option value="transfer">Havale/EFT</option>
                                <option value="check">Çek</option>
                                <option value="other">Diğer</option>
                            </select>
                        </div>
                        <div class="form-group" style="grid-column: span 2;">
                            <label>İade Nedeni</label>
                            <textarea name="refund_reason" rows="3" class="form-control" 
                                      placeholder="İade nedeni (opsiyonel)"
                                      style="width: 100%; padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; font-size: 13px; resize: vertical; min-height: 80px; font-family: inherit;"></textarea>
                        </div>
                    </div>
                </div>
                <div style="padding: 15px; border-top: 1px solid #d4d4d4; display: flex; justify-content: flex-end; gap: 10px;">
                    <a href="{% url 'reception:reservation_detail' reservation.pk %}" class="vb-button">İptal</a>
                    <button type="submit" class="vb-button primary">
                        <i class="fas fa-check"></i> İade Yap
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

