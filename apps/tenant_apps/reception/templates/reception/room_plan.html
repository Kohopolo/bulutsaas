{% extends "tenant/base.html" %}
{% load static %}
{% load dict_filters %}

{% block title %}Oda Planı - {{ hotel.name }}{% endblock %}

{% block content %}
<div class="content-body">
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-building"></i> Oda Planı - {{ hotel.name }}
            <div style="float: right;">
                <a href="{% url 'reception:room_status' %}" class="vb-button">
                    <i class="fas fa-list"></i> Oda Durumu Listesi
                </a>
                <a href="{% url 'reception:dashboard' %}" class="vb-button">
                    <i class="fas fa-arrow-left"></i> Dashboard
                </a>
            </div>
        </div>
        <div class="groupbox-body">
            {% if floors %}
                {% for floor in floors %}
                <div class="form-groupbox" style="margin-bottom: 20px;">
                    <div class="groupbox-header">
                        <i class="fas fa-layer-group"></i> {{ floor.name }} ({{ floor.floor_number }}. Kat)
                    </div>
                    <div class="groupbox-body">
                        <div class="room-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px;">
                            {% with rooms_list=floor_rooms|get_item:floor.id %}
                            {% if rooms_list %}
                                {% for item in rooms_list %}
                                {% with room=item.room reservation=item.reservation %}
                                <div class="room-card" 
                                     data-room-id="{{ room.id }}"
                                     data-status="{{ room.status }}"
                                     data-reservation-id="{% if reservation %}{{ reservation.id }}{% endif %}"
                                     onclick="showRoomDetails({{ room.id }})"
                                     style="
                                         background: {% if room.status == 'available' %}#d4edda{% elif room.status == 'occupied' %}#f8d7da{% elif room.status == 'maintenance' %}#fff3cd{% elif room.status == 'cleaning' %}#cfe2ff{% else %}#e2e3e5{% endif %};
                                         border: 2px solid {% if room.status == 'available' %}#28a745{% elif room.status == 'occupied' %}#dc3545{% elif room.status == 'maintenance' %}#ffc107{% elif room.status == 'cleaning' %}#0d6efd{% else %}#6c757d{% endif %};
                                         padding: 10px;
                                         border-radius: 3px;
                                         cursor: pointer;
                                         text-align: center;
                                         transition: all 0.2s;
                                     ">
                                    <div style="font-weight: bold; font-size: 16px; margin-bottom: 5px;">{{ room.number }}</div>
                                    <div style="font-size: 12px; color: #666; margin-bottom: 3px;">{{ room.room.name|truncatewords:2 }}</div>
                                    <div style="font-size: 11px; color: #999;">
                                        {% if reservation %}
                                            <i class="fas fa-user"></i> {{ reservation.customer.get_full_name|truncatewords:1 }}
                                        {% else %}
                                            {{ room.get_status_display }}
                                        {% endif %}
                                    </div>
                                </div>
                                {% endwith %}
                                {% endfor %}
                            {% else %}
                                <div style="grid-column: 1 / -1; text-align: center; color: #999; padding: 20px;">
                                    Bu katta henüz oda numarası tanımlanmamış.
                                </div>
                            {% endif %}
                            {% endwith %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p style="text-align: center; color: #999; padding: 40px;">
                    <i class="fas fa-info-circle" style="font-size: 48px; margin-bottom: 15px; display: block;"></i>
                    Henüz oda planı tanımlanmamış. Lütfen önce kat ve oda numaralarını tanımlayın.
                </p>
            {% endif %}
            
            <!-- Durum Açıklamaları -->
            <div class="form-groupbox" style="margin-top: 20px;">
                <div class="groupbox-header">
                    <i class="fas fa-info-circle"></i> Durum Açıklamaları
                </div>
                <div class="groupbox-body">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 30px; height: 30px; background: #d4edda; border: 2px solid #28a745; border-radius: 3px;"></div>
                            <span>Müsait</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 30px; height: 30px; background: #f8d7da; border: 2px solid #dc3545; border-radius: 3px;"></div>
                            <span>Dolu</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 30px; height: 30px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 3px;"></div>
                            <span>Bakım</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 30px; height: 30px; background: #cfe2ff; border: 2px solid #0d6efd; border-radius: 3px;"></div>
                            <span>Temizlik</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 30px; height: 30px; background: #e2e3e5; border: 2px solid #6c757d; border-radius: 3px;"></div>
                            <span>Diğer</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.room-card:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.form-groupbox {
    background: #f8f9fa;
    border: 1px solid #d4d4d4;
    border-radius: 3px;
    padding: 0;
}

.groupbox-header {
    background: #e8f4f8;
    border-bottom: 1px solid #c0d4e0;
    padding: 8px 12px;
    font-weight: bold;
    font-size: 14px;
    color: #2c5f8d;
}

.groupbox-body {
    padding: 12px;
}
</style>
{% endblock %}
