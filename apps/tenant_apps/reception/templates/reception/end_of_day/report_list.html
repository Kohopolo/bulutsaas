{% extends "tenant/base.html" %}
{% load static %}

{% block title %}Gün Sonu Raporları Listesi{% endblock %}

{% block content %}
<div class="content-body">
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-file-alt"></i> Gün Sonu Raporları Listesi
            <div style="float: right;">
                <a href="{% url 'reception:end_of_day_dashboard' %}{% if hotel %}?hotel_id={{ hotel.id }}{% endif %}" class="vb-button">
                    <i class="fas fa-arrow-left"></i> Dashboard
                </a>
            </div>
        </div>
        <div class="groupbox-body">
            <!-- Filtreler -->
            <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border: 1px solid #d4d4d4; border-radius: 3px;">
                <form method="get" id="filterForm">
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr) auto auto; gap: 10px; align-items: end;">
                        {% if accessible_hotels|length > 1 %}
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Otel</label>
                            <select name="hotel_id" style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                                <option value="">Tüm Oteller</option>
                                {% for h in accessible_hotels %}
                                <option value="{{ h.id }}" {% if selected_hotel_id == h.id %}selected{% endif %}>{{ h.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Rapor Türü</label>
                            <select name="report_type" style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                                <option value="">Tüm Raporlar</option>
                                {% for value, label in report_type_choices %}
                                <option value="{{ value }}" {% if selected_report_type == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Tarih Başlangıç</label>
                            <input type="date" name="date_from" value="{{ request.GET.date_from }}" 
                                   style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Tarih Bitiş</label>
                            <input type="date" name="date_to" value="{{ request.GET.date_to }}" 
                                   style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                        </div>
                        <div>
                            <button type="submit" class="vb-button primary" style="width: 100%;">
                                <i class="fas fa-filter"></i> Filtrele
                            </button>
                        </div>
                        <div>
                            <a href="{% url 'reception:end_of_day_report_list' %}" class="vb-button" style="width: 100%;">
                                <i class="fas fa-times"></i> Temizle
                            </a>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Raporlar Tablosu -->
            {% if reports %}
            <table class="vb-datagrid">
                <thead>
                    <tr>
                        <th>İşlem Tarihi</th>
                        <th>Otel</th>
                        <th>Rapor Türü</th>
                        <th>Format</th>
                        <th>Oluşturulma</th>
                        <th>İşlemler</th>
                    </tr>
                </thead>
                <tbody>
                    {% for report in reports %}
                    <tr>
                        <td>{{ report.operation.operation_date|date:"d.m.Y" }}</td>
                        <td>{{ report.operation.hotel.name }}</td>
                        <td>{{ report.get_report_type_display }}</td>
                        <td>{{ report.get_export_format_display|upper }}</td>
                        <td>{{ report.generated_at|date:"d.m.Y H:i:s" }}</td>
                        <td>
                            <a href="{% url 'reception:end_of_day_report_detail' report.pk %}" class="vb-button small">
                                <i class="fas fa-eye"></i> Görüntüle
                            </a>
                            {% if report.report_file %}
                            <a href="{% url 'reception:end_of_day_report_download' report.pk %}" class="vb-button small">
                                <i class="fas fa-download"></i> İndir
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Sayfalama -->
            {% if reports.has_other_pages %}
            <div style="margin-top: 20px; text-align: center;">
                <div class="pagination">
                    {% if reports.has_previous %}
                    <a href="?page={{ reports.previous_page_number }}{% if request.GET.hotel_id %}&hotel_id={{ request.GET.hotel_id }}{% endif %}{% if request.GET.report_type %}&report_type={{ request.GET.report_type }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}" class="vb-button">
                        <i class="fas fa-chevron-left"></i> Önceki
                    </a>
                    {% endif %}
                    <span style="padding: 8px 15px; display: inline-block;">
                        Sayfa {{ reports.number }} / {{ reports.paginator.num_pages }}
                    </span>
                    {% if reports.has_next %}
                    <a href="?page={{ reports.next_page_number }}{% if request.GET.hotel_id %}&hotel_id={{ request.GET.hotel_id }}{% endif %}{% if request.GET.report_type %}&report_type={{ request.GET.report_type }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}" class="vb-button">
                        Sonraki <i class="fas fa-chevron-right"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% else %}
            <p style="text-align: center; color: #666; padding: 40px;">
                <i class="fas fa-inbox" style="font-size: 48px; color: #ccc; margin-bottom: 10px; display: block;"></i>
                Henüz rapor bulunmamaktadır.
            </p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

