{% extends "tenant/base.html" %}
{% load static %}

{% block title %}Gün Sonu İşlemleri Listesi{% endblock %}

{% block content %}
<div class="content-body">
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-list"></i> Gün Sonu İşlemleri Listesi
            <div style="float: right;">
                <a href="{% url 'reception:end_of_day_dashboard' %}{% if hotel %}?hotel_id={{ hotel.id }}{% endif %}" class="vb-button">
                    <i class="fas fa-arrow-left"></i> Dashboard
                </a>
            </div>
        </div>
        <div class="groupbox-body">
            <!-- Filtreler -->
            <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border: 1px solid #d4d4d4; border-radius: 3px;">
                <form method="get" id="filterForm">
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr) auto auto; gap: 10px; align-items: end;">
                        {% if accessible_hotels|length > 1 %}
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Otel</label>
                            <select name="hotel_id" style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                                <option value="">Tüm Oteller</option>
                                {% for h in accessible_hotels %}
                                <option value="{{ h.id }}" {% if selected_hotel_id == h.id %}selected{% endif %}>{{ h.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Durum</label>
                            <select name="status" style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                                <option value="">Tüm Durumlar</option>
                                {% for value, label in status_choices %}
                                <option value="{{ value }}" {% if selected_status == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Tarih Başlangıç</label>
                            <input type="date" name="date_from" value="{{ request.GET.date_from }}" 
                                   style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Tarih Bitiş</label>
                            <input type="date" name="date_to" value="{{ request.GET.date_to }}" 
                                   style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                        </div>
                        <div>
                            <button type="submit" class="vb-button primary" style="width: 100%;">
                                <i class="fas fa-filter"></i> Filtrele
                            </button>
                        </div>
                        <div>
                            <a href="{% url 'reception:end_of_day_operation_list' %}" class="vb-button" style="width: 100%;">
                                <i class="fas fa-times"></i> Temizle
                            </a>
                        </div>
                    </div>
                </form>
            </div>

            <!-- İşlemler Tablosu -->
            {% if operations %}
            <table class="vb-datagrid">
                <thead>
                    <tr>
                        <th>Tarih</th>
                        <th>Otel</th>
                        <th>Durum</th>
                        <th>Otomasyon Türü</th>
                        <th>Oluşturan</th>
                        <th>Başlangıç</th>
                        <th>Bitiş</th>
                        <th>İşlemler</th>
                    </tr>
                </thead>
                <tbody>
                    {% for operation in operations %}
                    <tr>
                        <td>{{ operation.operation_date|date:"d.m.Y" }}</td>
                        <td>{{ operation.hotel.name }}</td>
                        <td>
                            <span class="badge badge-{% if operation.status == 'completed' %}success{% elif operation.status == 'failed' %}danger{% elif operation.status == 'running' %}warning{% else %}secondary{% endif %}">
                                {{ operation.get_status_display }}
                            </span>
                        </td>
                        <td>{{ operation.get_automation_type_display }}</td>
                        <td>{{ operation.created_by.get_full_name|default:operation.created_by.username }}</td>
                        <td>{% if operation.started_at %}{{ operation.started_at|date:"d.m.Y H:i" }}{% else %}-{% endif %}</td>
                        <td>{% if operation.completed_at %}{{ operation.completed_at|date:"d.m.Y H:i" }}{% else %}-{% endif %}</td>
                        <td>
                            <a href="{% url 'reception:end_of_day_operation_detail' operation.pk %}" class="vb-button small">
                                <i class="fas fa-eye"></i> Detay
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Sayfalama -->
            {% if operations.has_other_pages %}
            <div style="margin-top: 20px; text-align: center;">
                <div class="pagination">
                    {% if operations.has_previous %}
                    <a href="?page={{ operations.previous_page_number }}{% if request.GET.hotel_id %}&hotel_id={{ request.GET.hotel_id }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}" class="vb-button">
                        <i class="fas fa-chevron-left"></i> Önceki
                    </a>
                    {% endif %}
                    <span style="padding: 8px 15px; display: inline-block;">
                        Sayfa {{ operations.number }} / {{ operations.paginator.num_pages }}
                    </span>
                    {% if operations.has_next %}
                    <a href="?page={{ operations.next_page_number }}{% if request.GET.hotel_id %}&hotel_id={{ request.GET.hotel_id }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}" class="vb-button">
                        Sonraki <i class="fas fa-chevron-right"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% else %}
            <p style="text-align: center; color: #666; padding: 40px;">
                <i class="fas fa-inbox" style="font-size: 48px; color: #ccc; margin-bottom: 10px; display: block;"></i>
                Henüz işlem bulunmamaktadır.
            </p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}



{% load static %}

{% block title %}Gün Sonu İşlemleri Listesi{% endblock %}

{% block content %}
<div class="content-body">
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-list"></i> Gün Sonu İşlemleri Listesi
            <div style="float: right;">
                <a href="{% url 'reception:end_of_day_dashboard' %}{% if hotel %}?hotel_id={{ hotel.id }}{% endif %}" class="vb-button">
                    <i class="fas fa-arrow-left"></i> Dashboard
                </a>
            </div>
        </div>
        <div class="groupbox-body">
            <!-- Filtreler -->
            <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border: 1px solid #d4d4d4; border-radius: 3px;">
                <form method="get" id="filterForm">
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr) auto auto; gap: 10px; align-items: end;">
                        {% if accessible_hotels|length > 1 %}
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Otel</label>
                            <select name="hotel_id" style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                                <option value="">Tüm Oteller</option>
                                {% for h in accessible_hotels %}
                                <option value="{{ h.id }}" {% if selected_hotel_id == h.id %}selected{% endif %}>{{ h.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Durum</label>
                            <select name="status" style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                                <option value="">Tüm Durumlar</option>
                                {% for value, label in status_choices %}
                                <option value="{{ value }}" {% if selected_status == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Tarih Başlangıç</label>
                            <input type="date" name="date_from" value="{{ request.GET.date_from }}" 
                                   style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Tarih Bitiş</label>
                            <input type="date" name="date_to" value="{{ request.GET.date_to }}" 
                                   style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                        </div>
                        <div>
                            <button type="submit" class="vb-button primary" style="width: 100%;">
                                <i class="fas fa-filter"></i> Filtrele
                            </button>
                        </div>
                        <div>
                            <a href="{% url 'reception:end_of_day_operation_list' %}" class="vb-button" style="width: 100%;">
                                <i class="fas fa-times"></i> Temizle
                            </a>
                        </div>
                    </div>
                </form>
            </div>

            <!-- İşlemler Tablosu -->
            {% if operations %}
            <table class="vb-datagrid">
                <thead>
                    <tr>
                        <th>Tarih</th>
                        <th>Otel</th>
                        <th>Durum</th>
                        <th>Otomasyon Türü</th>
                        <th>Oluşturan</th>
                        <th>Başlangıç</th>
                        <th>Bitiş</th>
                        <th>İşlemler</th>
                    </tr>
                </thead>
                <tbody>
                    {% for operation in operations %}
                    <tr>
                        <td>{{ operation.operation_date|date:"d.m.Y" }}</td>
                        <td>{{ operation.hotel.name }}</td>
                        <td>
                            <span class="badge badge-{% if operation.status == 'completed' %}success{% elif operation.status == 'failed' %}danger{% elif operation.status == 'running' %}warning{% else %}secondary{% endif %}">
                                {{ operation.get_status_display }}
                            </span>
                        </td>
                        <td>{{ operation.get_automation_type_display }}</td>
                        <td>{{ operation.created_by.get_full_name|default:operation.created_by.username }}</td>
                        <td>{% if operation.started_at %}{{ operation.started_at|date:"d.m.Y H:i" }}{% else %}-{% endif %}</td>
                        <td>{% if operation.completed_at %}{{ operation.completed_at|date:"d.m.Y H:i" }}{% else %}-{% endif %}</td>
                        <td>
                            <a href="{% url 'reception:end_of_day_operation_detail' operation.pk %}" class="vb-button small">
                                <i class="fas fa-eye"></i> Detay
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Sayfalama -->
            {% if operations.has_other_pages %}
            <div style="margin-top: 20px; text-align: center;">
                <div class="pagination">
                    {% if operations.has_previous %}
                    <a href="?page={{ operations.previous_page_number }}{% if request.GET.hotel_id %}&hotel_id={{ request.GET.hotel_id }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}" class="vb-button">
                        <i class="fas fa-chevron-left"></i> Önceki
                    </a>
                    {% endif %}
                    <span style="padding: 8px 15px; display: inline-block;">
                        Sayfa {{ operations.number }} / {{ operations.paginator.num_pages }}
                    </span>
                    {% if operations.has_next %}
                    <a href="?page={{ operations.next_page_number }}{% if request.GET.hotel_id %}&hotel_id={{ request.GET.hotel_id }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.date_from %}&date_from={{ request.GET.date_from }}{% endif %}{% if request.GET.date_to %}&date_to={{ request.GET.date_to }}{% endif %}" class="vb-button">
                        Sonraki <i class="fas fa-chevron-right"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% else %}
            <p style="text-align: center; color: #666; padding: 40px;">
                <i class="fas fa-inbox" style="font-size: 48px; color: #ccc; margin-bottom: 10px; display: block;"></i>
                Henüz işlem bulunmamaktadır.
            </p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}




