{% extends "tenant/base.html" %}
{% load static %}

{% block title %}Rezervasyon Sil{% endblock %}

{% block content %}
<div class="content-body">
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-trash"></i> Rezervasyon Sil
        </div>
        <div class="groupbox-body">
            <div style="padding: 20px;">
                {% if delete_check.has_payment and not delete_check.can_delete %}
                <div style="padding: 15px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 3px; margin-bottom: 20px;">
                    <i class="fas fa-exclamation-triangle" style="color: #856404;"></i>
                    <strong>Uyarı:</strong> Bu rezervasyon için {{ delete_check.total_paid|floatformat:2 }} {{ reservation.currency }} ödeme alınmış.
                    <br><br>
                    {{ delete_check.message }}
                    {% if delete_check.refund_request %}
                    <br><br>
                    <a href="{% url 'refunds:refund_request_detail' delete_check.refund_request_id %}" class="vb-button small">
                        İade Talebini Görüntüle
                    </a>
                    {% elif delete_check.can_start_refund %}
                    <br><br>
                    <form method="post" action="{% url 'bungalovs:reservation_delete' reservation.pk %}" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="start_refund" value="1">
                        <button type="submit" class="vb-button small primary">
                            İade Sürecini Başlat
                        </button>
                    </form>
                    {% endif %}
                </div>
                {% endif %}
                
                <div style="text-align: center;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 64px; color: #ff9800; margin-bottom: 20px;"></i>
                    <h3>Bu rezervasyonu silmek istediğinizden emin misiniz?</h3>
                    <p><strong>Rezervasyon Kodu:</strong> {{ reservation.reservation_code }}</p>
                    <p><strong>Müşteri:</strong> {{ reservation.customer.first_name }} {{ reservation.customer.last_name }}</p>
                    <p><strong>Bungalov:</strong> {{ reservation.bungalov.code }} - {{ reservation.bungalov.name }}</p>
                    <p><strong>Tarih:</strong> {{ reservation.check_in_date|date:"d.m.Y" }} - {{ reservation.check_out_date|date:"d.m.Y" }}</p>
                    
                    {% if delete_check.can_delete %}
                    <form method="post" style="margin-top: 30px;">
                        {% csrf_token %}
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">
                                Onay için rezervasyon kodunu girin:
                            </label>
                            <input type="text" name="confirm_code" placeholder="{{ reservation.reservation_code }}" 
                                   style="padding: 8px; border: 1px solid #ced4da; border-radius: 3px; width: 300px; max-width: 100%;" required>
                        </div>
                        <button type="submit" class="vb-button danger" style="background: #dc3545; color: white; border-color: #dc3545;">
                            <i class="fas fa-trash"></i> Evet, Sil
                        </button>
                        <a href="{% url 'bungalovs:reservation_detail' reservation.pk %}" class="vb-button">
                            <i class="fas fa-times"></i> İptal
                        </a>
                    </form>
                    {% else %}
                    <a href="{% url 'bungalovs:reservation_detail' reservation.pk %}" class="vb-button" style="margin-top: 20px;">
                        <i class="fas fa-arrow-left"></i> Geri
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

