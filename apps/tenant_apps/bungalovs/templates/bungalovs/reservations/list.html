{% extends "tenant/base.html" %}
{% load static %}

{% block title %}Bungalov Rezervasyon Listesi{% endblock %}

{% block content %}
<div class="content-body">
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-list"></i> Bungalov Rezervasyon Listesi
            <div style="float: right;">
                <button onclick="openReservationModal()" class="vb-button primary">
                    <i class="fas fa-plus"></i> Yeni Rezervasyon
                </button>
            </div>
        </div>
        <div class="groupbox-body">
            <!-- Filtreler -->
            <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border: 1px solid #d4d4d4; border-radius: 3px;">
                <form method="get" id="filterForm">
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto auto; gap: 10px; margin-bottom: 10px; align-items: end;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Ara</label>
                            <input type="text" name="search" placeholder="Rezervasyon kodu, müşteri adı, email..." 
                                   value="{{ request.GET.search }}" 
                                   style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Durum</label>
                            <select name="status" style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                                <option value="">Tüm Durumlar</option>
                                {% for value, label in status_choices %}
                                <option value="{{ value }}" {% if request.GET.status == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Bungalov</label>
                            <select name="bungalov" style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                                <option value="">Tüm Bungalovlar</option>
                                {% for bungalov in bungalovs %}
                                <option value="{{ bungalov.id }}" {% if request.GET.bungalov == bungalov.id|stringformat:"s" %}selected{% endif %}>{{ bungalov.code }} - {{ bungalov.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 12px; font-weight: bold;">Check-in Tarihi</label>
                            <input type="date" name="check_in_date" value="{{ request.GET.check_in_date }}" 
                                   style="padding: 6px 10px; border: 1px solid #ced4da; border-radius: 3px; width: 100%; font-size: 13px;">
                        </div>
                        <div>
                            <button type="submit" class="vb-button primary" style="width: 100%;">
                                <i class="fas fa-filter"></i> Filtrele
                            </button>
                        </div>
                        <div>
                            <a href="{% url 'bungalovs:reservation_list' %}" class="vb-button" style="width: 100%;">
                                <i class="fas fa-times"></i> Temizle
                            </a>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- Rezervasyon Listesi -->
            {% if reservations %}
            <table class="vb-datagrid">
                <thead>
                    <tr>
                        <th>Rezervasyon Kodu</th>
                        <th>Müşteri</th>
                        <th>Bungalov</th>
                        <th>Check-in</th>
                        <th>Check-out</th>
                        <th>Gece</th>
                        <th>Tutar</th>
                        <th>Ödenen</th>
                        <th>Kalan</th>
                        <th>Durum</th>
                        <th>İşlemler</th>
                    </tr>
                </thead>
                <tbody>
                    {% for reservation in reservations %}
                    <tr>
                        <td><strong>{{ reservation.reservation_code }}</strong></td>
                        <td>{{ reservation.customer.first_name }} {{ reservation.customer.last_name }}</td>
                        <td>{{ reservation.bungalov.code }} - {{ reservation.bungalov.name }}</td>
                        <td>{{ reservation.check_in_date|date:"d.m.Y" }}<br><small>{{ reservation.check_in_time|time:"H:i" }}</small></td>
                        <td>{{ reservation.check_out_date|date:"d.m.Y" }}<br><small>{{ reservation.check_out_time|time:"H:i" }}</small></td>
                        <td>{{ reservation.total_nights }}</td>
                        <td><strong>{{ reservation.total_amount|floatformat:2 }} {{ reservation.currency }}</strong></td>
                        <td>
                            <span style="color: #388e3c; font-weight: bold;">{{ reservation.total_paid|floatformat:2 }} {{ reservation.currency }}</span>
                        </td>
                        <td>
                            <span style="color: {% if reservation.remaining_amount > 0 %}#d32f2f{% else %}#388e3c{% endif %}; font-weight: bold;">
                                {{ reservation.remaining_amount|floatformat:2 }} {{ reservation.currency }}
                            </span>
                        </td>
                        <td>
                            <span class="badge badge-{% if reservation.status == 'checked_in' %}success{% elif reservation.status == 'confirmed' %}info{% elif reservation.status == 'cancelled' %}danger{% else %}warning{% endif %}">
                                {{ reservation.get_status_display }}
                            </span>
                        </td>
                        <td>
                            <a href="{% url 'bungalovs:reservation_detail' reservation.pk %}" class="vb-button small" title="Detay">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="{% url 'bungalovs:reservation_payment_add' reservation.pk %}" class="vb-button small" style="background: #28a745; color: white; border-color: #28a745;" title="Ödeme Ekle">
                                <i class="fas fa-money-bill-wave"></i>
                            </a>
                            <a href="{% url 'bungalovs:reservation_update' reservation.pk %}" class="vb-button small" title="Düzenle">
                                <i class="fas fa-edit"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <!-- Sayfalama -->
            {% if reservations.has_other_pages %}
            <div style="margin-top: 20px; text-align: center;">
                {% if reservations.has_previous %}
                    <a href="?page={{ reservations.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}" class="vb-button">
                        <i class="fas fa-chevron-left"></i> Önceki
                    </a>
                {% endif %}
                
                <span style="margin: 0 15px;">
                    Sayfa {{ reservations.number }} / {{ reservations.paginator.num_pages }}
                </span>
                
                {% if reservations.has_next %}
                    <a href="?page={{ reservations.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}" class="vb-button">
                        Sonraki <i class="fas fa-chevron-right"></i>
                    </a>
                {% endif %}
            </div>
            {% endif %}
            {% else %}
            <p style="text-align: center; padding: 40px; color: #666;">
                <i class="fas fa-inbox" style="font-size: 48px; color: #ccc; margin-bottom: 15px; display: block;"></i>
                Rezervasyon bulunamadı.
            </p>
            {% endif %}
        </div>
    </div>
</div>

<script>
function openReservationModal() {
    window.location.href = "{% url 'bungalovs:reservation_create' %}";
}
</script>
{% endblock %}

