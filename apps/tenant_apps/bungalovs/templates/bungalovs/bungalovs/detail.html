{% extends "tenant/base.html" %}
{% load static %}

{% block title %}Bungalov Detay - {{ bungalov.code }}{% endblock %}

{% block content %}
<div class="content-body">
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-home"></i> Bungalov Detay: {{ bungalov.code }} - {{ bungalov.name }}
            <div style="float: right;">
                <a href="{% url 'bungalovs:bungalov_update' bungalov.pk %}" class="vb-button primary">
                    <i class="fas fa-edit"></i> Düzenle
                </a>
                <a href="{% url 'bungalovs:bungalov_list' %}" class="vb-button">
                    <i class="fas fa-arrow-left"></i> Geri
                </a>
            </div>
        </div>
        <div class="groupbox-body">
            <!-- Bungalov Bilgileri -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                <div class="form-groupbox">
                    <div class="groupbox-header">
                        <i class="fas fa-info-circle"></i> Temel Bilgiler
                    </div>
                    <div class="groupbox-body">
                        <div class="voucher-row">
                            <span class="voucher-label">Kod:</span>
                            <span class="voucher-value">{{ bungalov.code }}</span>
                        </div>
                        <div class="voucher-row">
                            <span class="voucher-label">Ad:</span>
                            <span class="voucher-value">{{ bungalov.name }}</span>
                        </div>
                        <div class="voucher-row">
                            <span class="voucher-label">Tip:</span>
                            <span class="voucher-value">{{ bungalov.bungalov_type.name }}</span>
                        </div>
                        <div class="voucher-row">
                            <span class="voucher-label">Konum:</span>
                            <span class="voucher-value">{{ bungalov.location|default:"-" }}</span>
                        </div>
                        <div class="voucher-row">
                            <span class="voucher-label">Durum:</span>
                            <span class="voucher-value">
                                <span class="badge badge-{% if bungalov.status == 'available' %}success{% elif bungalov.status == 'occupied' %}danger{% elif bungalov.status == 'cleaning' %}warning{% else %}secondary{% endif %}">
                                    {{ bungalov.get_status_display }}
                                </span>
                            </span>
                        </div>
                        <div class="voucher-row">
                            <span class="voucher-label">Aktif:</span>
                            <span class="voucher-value">
                                {% if bungalov.is_active %}
                                    <span style="color: green;"><i class="fas fa-check-circle"></i> Evet</span>
                                {% else %}
                                    <span style="color: red;"><i class="fas fa-times-circle"></i> Hayır</span>
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="form-groupbox">
                    <div class="groupbox-header">
                        <i class="fas fa-list"></i> Özellikler
                    </div>
                    <div class="groupbox-body">
                        {% if bungalov.features.all %}
                        <ul style="list-style: none; padding: 0;">
                            {% for feature in bungalov.features.all %}
                            <li style="padding: 5px 0;">
                                <i class="fas fa-check-circle" style="color: green; margin-right: 5px;"></i>
                                {{ feature.name }}
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <p style="color: #666; text-align: center;">Özellik tanımlanmamış</p>
                        {% endif %}
                    </div>
                </div>
                
                <div class="form-groupbox">
                    <div class="groupbox-header">
                        <i class="fas fa-calendar"></i> Rezervasyon Durumu
                    </div>
                    <div class="groupbox-body">
                        {% if current_reservation %}
                        <div style="padding: 10px; background: #fff3cd; border-radius: 3px;">
                            <strong>Aktif Rezervasyon:</strong><br>
                            {{ current_reservation.reservation_code }}<br>
                            <small>{{ current_reservation.customer.first_name }} {{ current_reservation.customer.last_name }}</small><br>
                            <small>{{ current_reservation.check_in_date|date:"d.m.Y" }} - {{ current_reservation.check_out_date|date:"d.m.Y" }}</small>
                        </div>
                        {% else %}
                        <p style="color: green; text-align: center;">
                            <i class="fas fa-check-circle" style="font-size: 24px; display: block; margin-bottom: 5px;"></i>
                            Müsait
                        </p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Aktif Rezervasyon -->
            {% if current_reservation %}
            <div class="form-groupbox" style="margin-bottom: 20px;">
                <div class="groupbox-header">
                    <i class="fas fa-calendar-check"></i> Aktif Rezervasyon
                </div>
                <div class="groupbox-body">
                    <table class="vb-datagrid">
                        <thead>
                            <tr>
                                <th>Rezervasyon Kodu</th>
                                <th>Müşteri</th>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Durum</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>{{ current_reservation.reservation_code }}</strong></td>
                                <td>{{ current_reservation.customer.first_name }} {{ current_reservation.customer.last_name }}</td>
                                <td>{{ current_reservation.check_in_date|date:"d.m.Y" }} {{ current_reservation.check_in_time|time:"H:i" }}</td>
                                <td>{{ current_reservation.check_out_date|date:"d.m.Y" }} {{ current_reservation.check_out_time|time:"H:i" }}</td>
                                <td>
                                    <span class="badge badge-{% if current_reservation.status == 'checked_in' %}success{% else %}info{% endif %}">
                                        {{ current_reservation.get_status_display }}
                                    </span>
                                </td>
                                <td>
                                    <a href="{% url 'bungalovs:reservation_detail' current_reservation.pk %}" class="vb-button small">
                                        <i class="fas fa-eye"></i> Detay
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
            
            <!-- Geçmiş Rezervasyonlar -->
            {% if past_reservations %}
            <div class="form-groupbox" style="margin-bottom: 20px;">
                <div class="groupbox-header">
                    <i class="fas fa-history"></i> Geçmiş Rezervasyonlar (Son 10)
                </div>
                <div class="groupbox-body">
                    <table class="vb-datagrid">
                        <thead>
                            <tr>
                                <th>Rezervasyon Kodu</th>
                                <th>Müşteri</th>
                                <th>Check-out</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reservation in past_reservations %}
                            <tr>
                                <td>{{ reservation.reservation_code }}</td>
                                <td>{{ reservation.customer.first_name }} {{ reservation.customer.last_name }}</td>
                                <td>{{ reservation.check_out_date|date:"d.m.Y" }}</td>
                                <td>
                                    <a href="{% url 'bungalovs:reservation_detail' reservation.pk %}" class="vb-button small">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
            
            <!-- Yaklaşan Rezervasyonlar -->
            {% if upcoming_reservations %}
            <div class="form-groupbox" style="margin-bottom: 20px;">
                <div class="groupbox-header">
                    <i class="fas fa-calendar-plus"></i> Yaklaşan Rezervasyonlar (Son 10)
                </div>
                <div class="groupbox-body">
                    <table class="vb-datagrid">
                        <thead>
                            <tr>
                                <th>Rezervasyon Kodu</th>
                                <th>Müşteri</th>
                                <th>Check-in</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reservation in upcoming_reservations %}
                            <tr>
                                <td>{{ reservation.reservation_code }}</td>
                                <td>{{ reservation.customer.first_name }} {{ reservation.customer.last_name }}</td>
                                <td>{{ reservation.check_in_date|date:"d.m.Y" }}</td>
                                <td>
                                    <a href="{% url 'bungalovs:reservation_detail' reservation.pk %}" class="vb-button small">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
            
            <!-- Temizlik Kayıtları -->
            {% if cleanings %}
            <div class="form-groupbox" style="margin-bottom: 20px;">
                <div class="groupbox-header">
                    <i class="fas fa-broom"></i> Temizlik Kayıtları (Son 10)
                </div>
                <div class="groupbox-body">
                    <table class="vb-datagrid">
                        <thead>
                            <tr>
                                <th>Tarih</th>
                                <th>Tip</th>
                                <th>Durum</th>
                                <th>Atanan</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for cleaning in cleanings %}
                            <tr>
                                <td>{{ cleaning.cleaning_date|date:"d.m.Y" }}</td>
                                <td>{{ cleaning.get_cleaning_type_display }}</td>
                                <td>
                                    <span class="badge badge-{% if cleaning.status == 'clean' %}success{% else %}warning{% endif %}">
                                        {{ cleaning.get_status_display }}
                                    </span>
                                </td>
                                <td>{{ cleaning.assigned_to.get_full_name|default:"-" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
            
            <!-- Bakım Kayıtları -->
            {% if maintenances %}
            <div class="form-groupbox">
                <div class="groupbox-header">
                    <i class="fas fa-tools"></i> Bakım Kayıtları (Son 10)
                </div>
                <div class="groupbox-body">
                    <table class="vb-datagrid">
                        <thead>
                            <tr>
                                <th>Başlık</th>
                                <th>Tip</th>
                                <th>Öncelik</th>
                                <th>Durum</th>
                                <th>Planlanan Tarih</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for maintenance in maintenances %}
                            <tr>
                                <td>{{ maintenance.title }}</td>
                                <td>{{ maintenance.get_maintenance_type_display }}</td>
                                <td>
                                    <span class="badge badge-{% if maintenance.priority == 'urgent' %}danger{% elif maintenance.priority == 'high' %}warning{% else %}info{% endif %}">
                                        {{ maintenance.get_priority_display }}
                                    </span>
                                </td>
                                <td>
                                    <span class="badge badge-{% if maintenance.status == 'completed' %}success{% elif maintenance.status == 'in_progress' %}warning{% else %}secondary{% endif %}">
                                        {{ maintenance.get_status_display }}
                                    </span>
                                </td>
                                <td>{{ maintenance.planned_date|date:"d.m.Y"|default:"-" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}





