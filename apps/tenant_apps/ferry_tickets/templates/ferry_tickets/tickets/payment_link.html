{% extends "tenant/base.html" %}
{% load static %}

{% block title %}Ödeme Linki - {{ ticket.ticket_code }}{% endblock %}

{% block content %}
<div class="content-body">
    <div class="groupbox">
        <div class="groupbox-header">
            <i class="fas fa-link"></i> Ödeme Linki: {{ ticket.ticket_code }}
            <div style="float: right;">
                <a href="{% url 'ferry_tickets:ticket_detail' ticket.pk %}" class="vb-button">
                    <i class="fas fa-arrow-left"></i> Geri
                </a>
            </div>
        </div>
        <div class="groupbox-body">
            <div style="max-width: 800px; margin: 0 auto;">
                <div class="form-groupbox" style="margin-bottom: 20px;">
                    <div class="groupbox-header">
                        <i class="fas fa-info-circle"></i> Bilet Bilgileri
                    </div>
                    <div class="groupbox-body">
                        <div class="voucher-row">
                            <span class="voucher-label">Bilet Kodu:</span>
                            <span class="voucher-value">{{ ticket.ticket_code }}</span>
                        </div>
                        <div class="voucher-row">
                            <span class="voucher-label">Müşteri:</span>
                            <span class="voucher-value">
                                {% if ticket.customer %}
                                    {{ ticket.customer.get_full_name }}
                                {% else %}
                                    -
                                {% endif %}
                            </span>
                        </div>
                        <div class="voucher-row">
                            <span class="voucher-label">Toplam Tutar:</span>
                            <span class="voucher-value">{{ ticket.total_amount|floatformat:2 }} {{ ticket.currency }}</span>
                        </div>
                        <div class="voucher-row">
                            <span class="voucher-label">Ödenen:</span>
                            <span class="voucher-value">{{ ticket.total_paid|floatformat:2 }} {{ ticket.currency }}</span>
                        </div>
                        <div class="voucher-row">
                            <span class="voucher-label">Kalan Tutar:</span>
                            <span class="voucher-value" style="color: red; font-weight: bold;">{{ ticket.get_remaining_amount|floatformat:2 }} {{ ticket.currency }}</span>
                        </div>
                    </div>
                </div>
                
                {% if payment_url %}
                <div class="form-groupbox" style="margin-bottom: 20px;">
                    <div class="groupbox-header">
                        <i class="fas fa-credit-card"></i> Ödeme Linki
                    </div>
                    <div class="groupbox-body">
                        <div class="form-group">
                            <label><strong>Ödeme Linki:</strong></label>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <input type="text" 
                                       id="paymentLink" 
                                       value="{{ request.scheme }}://{{ request.get_host }}{{ payment_url }}" 
                                       readonly 
                                       class="form-control"
                                       style="font-family: monospace;">
                                <button onclick="copyPaymentLink()" class="vb-button primary">
                                    <i class="fas fa-copy"></i> Kopyala
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-top: 20px;">
                            <a href="{{ payment_url }}" target="_blank" class="vb-button" style="background: #28a745; color: white; padding: 10px 20px;">
                                <i class="fas fa-external-link-alt"></i> Ödeme Sayfasını Aç
                            </a>
                        </div>
                    </div>
                </div>
                
                {% if public_url %}
                <div class="form-groupbox" style="margin-bottom: 20px;">
                    <div class="groupbox-header">
                        <i class="fas fa-eye"></i> Voucher Görüntüleme Linki
                    </div>
                    <div class="groupbox-body">
                        <div class="form-group">
                            <label><strong>Voucher Linki:</strong></label>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <input type="text" 
                                       id="voucherLink" 
                                       value="{{ request.scheme }}://{{ request.get_host }}{{ public_url }}" 
                                       readonly 
                                       class="form-control"
                                       style="font-family: monospace;">
                                <button onclick="copyVoucherLink()" class="vb-button primary">
                                    <i class="fas fa-copy"></i> Kopyala
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% else %}
                <div class="alert alert-warning" style="padding: 15px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; margin: 20px 0;">
                    <i class="fas fa-exclamation-triangle"></i> Ödeme linki oluşturulamadı. Lütfen tekrar deneyin.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
function copyPaymentLink() {
    const input = document.getElementById('paymentLink');
    input.select();
    document.execCommand('copy');
    alert('Ödeme linki kopyalandı!');
}

function copyVoucherLink() {
    const input = document.getElementById('voucherLink');
    input.select();
    document.execCommand('copy');
    alert('Voucher linki kopyalandı!');
}
</script>
{% endblock %}





